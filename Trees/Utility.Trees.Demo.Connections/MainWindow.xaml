<Window
    x:Class="Utility.Trees.Demo.Connections.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conn="clr-namespace:Utility.Trees.Demo.Connections"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Utility.Trees.Demo.Connections"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tree="clr-namespace:Utility.Trees;assembly=Utility.Trees"
    Title="MainWindow"
    Width="800"
    Height="450"
    d:DataContext="{d:DesignInstance local:ConnectionsViewModel}"
    mc:Ignorable="d">

    <FrameworkElement.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Utility.WPF.Controls.Trees;component/Themes/Aligned.xaml" />
                <ResourceDictionary Source="/Utility.WPF.Controls.Trees;component/TreeListView.xaml" />
                <ResourceDictionary Source="/Utility.WPF.Pipes;component/Themes/Generic.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <Style BasedOn="{StaticResource AlignedTreeViewitemStyle}" TargetType="TreeViewItem">
                <Setter Property="IsExpanded" Value="True" />
                <Setter Property="Background" Value="GhostWhite" />
            </Style>

            <Style TargetType="Button">
                <Setter Property="Width" Value="100" />
                <Setter Property="Margin" Value="2" />
            </Style>

            <Style x:Key="HeaderGridStyle" TargetType="Grid">
                <Setter Property="Height" Value="20" />
            </Style>

            <Style x:Key="HeaderTextBlockStyle" TargetType="TextBlock">
                <Setter Property="Margin" Value="5,0,0,0" />
                <Setter Property="VerticalAlignment" Value="Center" />
            </Style>

            <Style x:Key="HeaderPathStyle" TargetType="Path">
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Fill" Value="Gray" />
                <Setter Property="Width" Value="20" />
                <Setter Property="HorizontalAlignment" Value="Center" />
                <Setter Property="Margin" Value="5,0,5,0" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
            </Style>

            <DataTemplate x:Key="HeaderTemplateDefault">
                <Grid Style="{StaticResource HeaderGridStyle}">
                    <TextBlock Style="{StaticResource HeaderTextBlockStyle}" Text="{Binding}" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="HeaderTemplateArrowUp">
                <Grid Style="{StaticResource HeaderGridStyle}">
                    <Path Data="M 7,3 L 13,3 L 10,0 L 7,3" Style="{StaticResource HeaderPathStyle}" />
                    <TextBlock Style="{StaticResource HeaderTextBlockStyle}" Text="{Binding}" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="HeaderTemplateArrowDown">
                <Grid Style="{StaticResource HeaderGridStyle}">
                    <Path Data="M 7,0 L 10,3 L 13,0 L 7,0" Style="{StaticResource HeaderPathStyle}" />
                    <TextBlock Style="{StaticResource HeaderTextBlockStyle}" Text="{Binding}" />
                </Grid>
            </DataTemplate>

            <local:DirectionBrushConverter x:Key="DirectionBrushConverter" />

            <PathGeometry x:Key="CrossGeometry">
                <PathGeometry.Figures>
                    <PathFigure StartPoint="0,0">
                        <PathFigure.Segments>
                            <LineSegment Point="100,100" />
                            <ArcSegment
                                IsLargeArc="True"
                                Point="0,0"
                                RotationAngle="45"
                                Size="50,50"
                                SweepDirection="Clockwise" />
                            <ArcSegment
                                IsLargeArc="True"
                                Point="100,100"
                                RotationAngle="45"
                                Size="50,50"
                                SweepDirection="Clockwise" />
                        </PathFigure.Segments>
                    </PathFigure>
                </PathGeometry.Figures>
            </PathGeometry>
        </ResourceDictionary>
    </FrameworkElement.Resources>


    <DockPanel>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="4*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid x:Name="Grid">

                    <Grid Background="Transparent">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <!--<ColumnDefinition Width="500"></ColumnDefinition>-->
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TreeView
                            x:Name="TreeView"
                            BorderThickness="0"
                            ItemsSource="{Binding Tree.Items}"
                            VirtualizingStackPanel.IsVirtualizing="False">
                            <TreeView.ItemContainerStyle>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <!--  BasedOn="{StaticResource TreeListViewItemStyle}">  -->
                                    <Setter Property="IsExpanded" Value="True" />
                                </Style>
                            </TreeView.ItemContainerStyle>
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Items}">
                                    <Viewbox Height="15">
                                        <StackPanel Orientation="Horizontal">
                                            <ContentControl Content="{Binding Data.Name}" />
                                            <TextBox Width="100" Text="{Binding Data.Value, Mode=TwoWay}" />
                                        </StackPanel>
                                    </Viewbox>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                            <!--<tree:TreeListView.Columns>
                            -->
                            <!--  Create the first column containing the expand button and the type name.  -->
                            <!--
                        <GridViewColumn Header="Name" Width="150">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Viewbox Height="15">
                                        <StackPanel Orientation="Horizontal">
                            -->
                            <!--  The Expander Button (can be used in any column (typically the first one))  -->
                            <!--
                                            <tree:TreeListViewExpander/>
                                            <ContentControl Content="{Binding Data.Name}"/>
                                            <TextBox Width="100" Text="{Binding Data.Value}">                                                </TextBox>
                            -->
                            <!--  Display the name of the DataElement  -->
                            <!--<TextBlock Text="{Binding Content}"/>-->
                            <!--
                                        </StackPanel>
                                    </Viewbox>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </tree:TreeListView.Columns>-->
                        </TreeView>

                        <!--<Grid Grid.Column="1" Background="Transparent"/>-->

                        <local:NodeGroup
                            x:Name="TreeView2"
                            Grid.Column="1"
                            Background="Transparent"
                            ItemsSource="{Binding ServiceModel}">
                            <local:NodeGroup.Style>
                                <Style TargetType="{x:Type local:NodeGroup}">
                                    <Setter Property="BorderThickness" Value="0" />
                                </Style>
                            </local:NodeGroup.Style>
                            <ItemsControl.ItemContainerStyle>
                                <Style BasedOn="{StaticResource {x:Type local:Node}}" TargetType="{x:Type local:Node}">
                                    <Setter Property="Inputs" Value="{Binding Inputs}" />
                                    <Setter Property="Outputs" Value="{Binding Outputs}" />
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </local:NodeGroup>
                    </Grid>

                    <ItemsControl x:Name="ItemsControl" ItemsSource="{Binding Lines}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas IsItemsHost="True" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Line
                                    x:Name="line"
                                    Stroke="{Binding Direction, Converter={StaticResource DirectionBrushConverter}}"
                                    StrokeDashArray="1"
                                    StrokeThickness="1"
                                    X1="{Binding StartPoint.X}"
                                    X2="{Binding EndPoint.X}"
                                    Y1="{Binding StartPoint.Y}"
                                    Y2="{Binding EndPoint.Y}" />
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter TargetName="line" Property="StrokeThickness" Value="3" />
                                    </DataTrigger>
                                    <!--<DataTrigger Binding="{Binding IsDeleted}" Value="True">
                                    <Setter Property="IsEnabled" TargetName="line" Value="False"/>
                                </DataTrigger>-->
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>



                <ItemsControl Grid.Row="1" HorizontalAlignment="Right">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <Button Click="Clear_Click" Content="Clear" />


                </ItemsControl>


                <Grid
                    Grid.Row="1"
                    HorizontalAlignment="Left"
                    DockPanel.Dock="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />

                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Margin="0,0,8,0"
                        Text="Point0"
                        TextAlignment="Right" />
                    <TextBlock
                        Grid.Row="1"
                        Margin="0,0,8,0"
                        Text="Point1"
                        TextAlignment="Right" />
                    <TextBlock
                        Grid.Row="2"
                        Margin="0,0,8,0"
                        Text="Last"
                        TextAlignment="Right" />
                    <ContentControl Grid.Column="1" Content="{Binding Point0}" />
                    <ContentControl
                        Grid.Row="1"
                        Grid.Column="1"
                        Content="{Binding Point0}" />
                    <ContentControl
                        Grid.Row="2"
                        Grid.Column="1"
                        Content="{Binding Last}" />

                </Grid>
                <local:SortableListView
                    x:Name="listView_Lines"
                    Grid.Row="2"
                    ItemsSource="{Binding Lines}">

                    <ListView.View>

                        <GridView AllowsColumnReorder="true" ColumnHeaderTemplate="{StaticResource HeaderTemplateDefault}">

                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=Id}"
                                Header="Id" />
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=StartPoint.X}"
                                Header="X1" />
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=StartPoint.Y}"
                                Header="Y1" />
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=EndPoint.X}"
                                Header="X2" />
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=EndPoint.Y}"
                                Header="Y2" />
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=Direction}"
                                Header="Direction" />
                            <!--<GridViewColumn Width="auto">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <ToggleButton Command="{Binding IsDeleted}"  >

                                        </ToggleButton>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>-->

                        </GridView>

                    </ListView.View>
                </local:SortableListView>

                <local:SortableListView
                    x:Name="listView_Connections"
                    Grid.Row="3"
                    ItemsSource="{Binding Connections}">
                    <ListView.View>
                        <GridView AllowsColumnReorder="true" ColumnHeaderTemplate="{StaticResource HeaderTemplateDefault}">
                            <GridViewColumn
                                Width="100"
                                DisplayMemberBinding="{Binding Path=Id}"
                                Header="Id" />
                            <GridViewColumn
                                Width="70"
                                DisplayMemberBinding="{Binding Path=ViewModelName}"
                                Header="ViewModel" />
                            <GridViewColumn
                                Width="70"
                                DisplayMemberBinding="{Binding Path=ServiceName}"
                                Header="Service" />
                            <GridViewColumn
                                Width="70"
                                DisplayMemberBinding="{Binding Path=ParameterName}"
                                Header="Parameter" />
                            <GridViewColumn
                                Width="200"
                                DisplayMemberBinding="{Binding Path=Movement}"
                                Header="Movement" />
                            <GridViewColumn Width="auto">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <ToggleButton
                                            Background="Transparent"
                                            BorderBrush="Transparent"
                                            IsChecked="{Binding IsDeleted}">
                                            <Path
                                                Width="20"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Data="{StaticResource CrossGeometry}"
                                                Stretch="Uniform"
                                                Stroke="Red"
                                                StrokeThickness="4" />
                                        </ToggleButton>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </local:SortableListView>

                <local:SortableListView Grid.Row="4" ItemsSource="{Binding Logs}">
                    <ListView.View>
                        <GridView AllowsColumnReorder="true" ColumnHeaderTemplate="{StaticResource HeaderTemplateDefault}">
                            <GridViewColumn
                                Width="300"
                                DisplayMemberBinding="{Binding Path=MethodName}"
                                Header="Name" />
                            <GridViewColumn
                                Width="200"
                                DisplayMemberBinding="{Binding Path=DateTime}"
                                Header="Time" />
                        </GridView>
                    </ListView.View>
                </local:SortableListView>
            </Grid>


            <DockPanel Grid.Column="1">
                <ContentControl x:Name="pipe_view" DockPanel.Dock="Top" />
                <ContentControl x:Name="queue_view" />
            </DockPanel>
        </Grid>

        <!--<local:ConnectionsView>
            <local:ConnectionsView.TreeView>-->

        <!--</local:ConnectionsView.TreeView>
        </local:ConnectionsView>-->
    </DockPanel>
</Window>
