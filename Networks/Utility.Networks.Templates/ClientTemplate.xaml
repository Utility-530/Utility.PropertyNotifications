<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:nw="clr-namespace:Utility.Networks;assembly=Utility.Networks" 
                    xmlns:conv="http://schemas.utility.com/converters"
                    xmlns:objects="http://schemas.utility.com/objects" xmlns:i="http://schemas.microsoft.com/xaml/behaviors" xmlns:beh="http://schemas.utility.com/behaviors">

    <DataTemplate DataType="{x:Type nw:Client}">

        <Grid  x:Name="MainGrid">
            <Grid.RowDefinitions>
                <RowDefinition Height="0.6*"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel>
                <Label DockPanel.Dock="Top">Last Server response</Label>
                <TextBlock Text="{Binding TimeSinceLastPong}" Margin="8,0"></TextBlock>
                <Label DockPanel.Dock="Top">Average Latency (s)</Label>
                <TextBlock Text="{Binding Latency, StringFormat=\{0:ss\\:ffffff\}}" Margin="8,0"></TextBlock>
            </StackPanel>

            <ListBox Grid.Row="1"  ItemsSource="{Binding Sent}"  Margin="5" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding}" Margin="2"/>
                            <!--<Ellipse Fill="Red" Height="20" Width="20"></Ellipse>-->
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <ListBox x:Name="ReceivedListBox" ItemsSource="{Binding Received}" Grid.Row="2" Margin="5">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding}" Margin="2"/>
                            <!--<Ellipse Fill="Red" Height="20" Width="20"></Ellipse>-->
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Grid.Resources>
                <RadialGradientBrush x:Key="FlashBrush"  Opacity="0">
                    <GradientStop Color="White" x:Name="Stop1" Offset="0.5" />
                    <GradientStop Color="#579" x:Name="Stop2" Offset="1" />
                </RadialGradientBrush>
            </Grid.Resources>

            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Background" Value="{StaticResource FlashBrush}"></Setter>

        
                </Style>
            </Grid.Style>
            <i:Interaction.Triggers>
                <beh:CollectionChangedTrigger Source="{Binding Received}">
                    <beh:CollectionChangedTrigger.Actions>
                        <i:ControlStoryboardAction ControlStoryboardOption="Play">
                            <i:ControlStoryboardAction.Storyboard>
                                <Storyboard AutoReverse="True">
                                    <DoubleAnimation Storyboard.TargetName="MainGrid"
                                                     Storyboard.TargetProperty="Background.Opacity" 
                                       From="0" To="0.3" Duration="0:0:0.3"/>
                                </Storyboard>
                            </i:ControlStoryboardAction.Storyboard>
                        </i:ControlStoryboardAction>
                    </beh:CollectionChangedTrigger.Actions>
                </beh:CollectionChangedTrigger>
            </i:Interaction.Triggers>
        </Grid>
    </DataTemplate>

</ResourceDictionary>