<UserControl x:Class="Utility.WPF.Demo.Lists.VirtualisationUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Utility.WPF.Demo.Lists"
             mc:Ignorable="d"
             xmlns:conv="http://schemas.utility.com/converters"
             xmlns:demo="http://schemas.utility.com/demo_data" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:beh="http://schemas.utility.com/behaviors"
             d:DataContext="{d:DesignInstance local:VirtualisationViewModel}"

             d:DesignHeight="450" d:DesignWidth="800">
    <FrameworkElement.DataContext>
        <local:VirtualisationViewModel ></local:VirtualisationViewModel>
    </FrameworkElement.DataContext>
    <FrameworkElement.Resources>
        <Style TargetType="{x:Type TextBlock}">
            <Setter Property="Margin" Value="4"></Setter>
        </Style>
    </FrameworkElement.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"></RowDefinition>
            <RowDefinition Height="500"></RowDefinition>
            <RowDefinition Height="500"></RowDefinition>
        </Grid.RowDefinitions>
        <WrapPanel>
            <TextBlock Text="First"></TextBlock>
            <TextBlock Text="{Binding First}"></TextBlock>
            <TextBlock Text="Second"></TextBlock>
            <TextBlock Text="{Binding Second}" ></TextBlock>
        </WrapPanel>
        <ListView 
            x:Name="ListView"
                  local:TrackVisibleItems.Enabled="True"
                  local:TrackVisibleItems.Length="{Binding Length, Mode=OneWay}"
                  local:TrackVisibleItems.FirstVisibleIndex="{Binding First, Mode=TwoWay}"
                  local:TrackVisibleItems.LastVisibleIndex="{Binding Second, Mode=TwoWay}"
                  ItemsSource="{Binding Path=Collection}"
                  Grid.Row="1">
            <ListView.View>
                <GridView AllowsColumnReorder="true" ColumnHeaderToolTip="Employee Information">
                    <GridViewColumn DisplayMemberBinding="{Binding Path=company}" Header="Company" Width="200" />
                    <GridViewColumn DisplayMemberBinding="{Binding Path=name}" Width="300">
                        <GridViewColumnHeader>Name
                            <GridViewColumnHeader.ContextMenu>
                                <ContextMenu Name="LastNameCM">
                                    <MenuItem Header="Ascending" />
                                    <MenuItem Header="Descending" />
                                </ContextMenu>
                            </GridViewColumnHeader.ContextMenu>
                        </GridViewColumnHeader>
                    </GridViewColumn>
                    <GridViewColumn DisplayMemberBinding="{Binding Path=phone}" Header="Phone" Width="200" />
                  
                </GridView>
            </ListView.View>
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel></StackPanel>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>  
        </ListView>


        <DataGrid ItemsSource="{Binding Contacts}"
          VirtualizingPanel.IsVirtualizing="True"
          VirtualizingPanel.VirtualizationMode="Recycling"
          ScrollViewer.CanContentScroll="True"
          RowHeight="24"
                   Grid.Row="2">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Name" Binding="{Binding name}"></DataGridTextColumn>
                <DataGridTextColumn Header="Phone" Binding="{Binding phone}"></DataGridTextColumn>
                <DataGridTextColumn Header="Company" Binding="{Binding company}"></DataGridTextColumn>
            </DataGrid.Columns>
            <FrameworkElement.DataContext>
                <local:ContactsViewModel/>

            </FrameworkElement.DataContext>
            <DataGrid.Resources>
               
                
                <!-- Shimmer style -->
                <!--<Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="White"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridRow">
                                        <Grid>
                                             --><!--Shimmer rectangle fills the row--><!-- 
                                            <Rectangle Name="ShimmerRect" Height="{TemplateBinding Height}" Width="{TemplateBinding ActualWidth}">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#EEE" Offset="0"/>
                                                        <GradientStop Color="#DDD" Offset="0.5"/>
                                                        <GradientStop Color="#EEE" Offset="1"/>
                                                        <LinearGradientBrush.RelativeTransform>
                                                            <TranslateTransform x:Name="ShimmerTransform" X="0"/>
                                                        </LinearGradientBrush.RelativeTransform>
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>
                                            <ContentPresenter />
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsVisible" Value="True">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation
                                                    Storyboard.TargetName="ShimmerTransform"
                                                    Storyboard.TargetProperty="X"
                                                    From="-1" To="1"
                                                    Duration="0:0:1.2"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>-->
            </DataGrid.Resources>
            <i:Interaction.Behaviors>
                <beh:VirtualisationBehavior

                    FirstVisible="{Binding FirstVisible, Mode=TwoWay}"
                    VisibleCount="{Binding VisibleCount, Mode=TwoWay}"/>
            </i:Interaction.Behaviors>
        </DataGrid>
    </Grid>
</UserControl>