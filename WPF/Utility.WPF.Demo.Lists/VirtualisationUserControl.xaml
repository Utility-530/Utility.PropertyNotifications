<UserControl x:Class="Utility.WPF.Demo.Lists.VirtualisationUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Utility.WPF.Demo.Lists"
             mc:Ignorable="d"
             xmlns:conv="http://schemas.utility.com/converters"
             xmlns:demo="http://schemas.utility.com/demo_data" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:beh="http://schemas.utility.com/behaviors"
             d:DataContext="{d:DesignInstance local:VirtualisationViewModel}"

             d:DesignHeight="450" d:DesignWidth="800">
    <FrameworkElement.DataContext>
        <local:VirtualisationViewModel ></local:VirtualisationViewModel>
    </FrameworkElement.DataContext>
    <FrameworkElement.Resources>
        <Style TargetType="{x:Type TextBlock}">
            <Setter Property="Margin" Value="4"></Setter>
        </Style>


        <Style x:Key="AnimatedScrollBarThumb" TargetType="{x:Type Thumb}">
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Grid>
                            <Border x:Name="ThumbBorder"
                                    Background="#B0B0B0"
                                    CornerRadius="6"
                                    Margin="2,0"
                                    Height="{TemplateBinding Height}"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#808080"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#606060"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AnimatedScrollBar" TargetType="{x:Type ScrollBar}">
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="False"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="Width" Value="14"/>
            <Setter Property="MinWidth" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid x:Name="Bg" Background="#F5F5F5">
                            <local:AnimatedTrack x:Name="PART_Track" IsDirectionReversed="True" IsEnabled="{TemplateBinding IsMouseOver}">
                                <local:AnimatedTrack.Thumb>
                                    <Thumb Style="{StaticResource AnimatedScrollBarThumb}"
                                           />
                                </local:AnimatedTrack.Thumb>
                            </local:AnimatedTrack>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
    </FrameworkElement.Resources>
    <UniformGrid Rows="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"></RowDefinition>
                <RowDefinition Height="500"></RowDefinition>
            </Grid.RowDefinitions>
            <WrapPanel>
                <TextBlock Text="First"></TextBlock>
                <TextBlock Text="{Binding First}"></TextBlock>
                <TextBlock Text="Second"></TextBlock>
                <TextBlock Text="{Binding Second}" ></TextBlock>
            </WrapPanel>
            <ListView 
         x:Name="ListView"
               local:TrackVisibleItems.Enabled="True"
               local:TrackVisibleItems.Length="{Binding Length, Mode=OneWay}"
               local:TrackVisibleItems.FirstVisibleIndex="{Binding First, Mode=TwoWay}"
               local:TrackVisibleItems.LastVisibleIndex="{Binding Second, Mode=TwoWay}"
               ItemsSource="{Binding Path=Collection}"
               Grid.Row="1">
                <ListView.View>
                    <GridView AllowsColumnReorder="true" ColumnHeaderToolTip="Employee Information">
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Company}" Header="Company" Width="200" />
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Name}" Width="300">
                            <GridViewColumnHeader>Name
                                <GridViewColumnHeader.ContextMenu>
                                    <ContextMenu Name="LastNameCM">
                                        <MenuItem Header="Ascending" />
                                        <MenuItem Header="Descending" />
                                    </ContextMenu>
                                </GridViewColumnHeader.ContextMenu>
                            </GridViewColumnHeader>
                        </GridViewColumn>
                        <GridViewColumn DisplayMemberBinding="{Binding Path=Phone}" Header="Phone" Width="200" />

                    </GridView>
                </ListView.View>
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel></StackPanel>
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
            </ListView>
        </Grid>





        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>
            <DataGrid ItemsSource="{Binding Contacts}"
       VirtualizingPanel.IsVirtualizing="True"
       VirtualizingPanel.VirtualizationMode="Recycling"
       ScrollViewer.CanContentScroll="True"
      Grid.Row="0"
       RowHeight="24"
               >
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}"></DataGridTextColumn>
                    <DataGridTextColumn Header="Phone" Binding="{Binding Phone}"></DataGridTextColumn>
                    <DataGridTextColumn Header="Company" Binding="{Binding Company}"></DataGridTextColumn>
                </DataGrid.Columns>
                <FrameworkElement.DataContext>
                    <local:ContactsViewModel/>

                </FrameworkElement.DataContext>
                <DataGrid.Resources>
                    <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource AnimatedScrollBar}"></Style>
                </DataGrid.Resources>
                <i:Interaction.Behaviors>
                    <beh:VirtualisationBehavior

                 FirstVisible="{Binding FirstVisible, Mode=TwoWay}"
                 VisibleCount="{Binding VisibleCount, Mode=TwoWay}"/>
                </i:Interaction.Behaviors>
            </DataGrid>
            <Grid Grid.Row="1"></Grid>
        </Grid>
   
    </UniformGrid>
</UserControl>