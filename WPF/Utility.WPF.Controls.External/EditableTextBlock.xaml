<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Custom.Controls" 
                    xmlns:hex="http://hexinnovation.com/math"
                    xmlns:ex="clr-namespace:Utility.WPF.Controls.External"
                    xmlns:res="http://schemas.utility.com/resourcedictionary" xmlns:i="http://schemas.microsoft.com/xaml/behaviors">

    <ResourceDictionary.MergedDictionaries>
        <res:SharedResourceDictionary Source="/Utility.WPF.Geometries;component/Resources.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <hex:MathConverter x:Key="MathConverter"></hex:MathConverter>
    <ex:DefaultConverter x:Key="DefaultConverter"></ex:DefaultConverter>
    
    <Style TargetType="{x:Type local:EditableTextBlock}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate x:Name="editableTextBlockTemplate" TargetType="{x:Type local:EditableTextBlock}">
                    <Grid Height="{Binding FontSize,  Converter={StaticResource MathConverter}, ConverterParameter=x+16, RelativeSource={RelativeSource Mode=TemplatedParent}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>

                        </Grid.ColumnDefinitions>

                        <Border x:Name="Var_Animation_0to1" Width="0"
                               />
              
                        <Border Grid.Column="1" BorderThickness="1.0" x:Name="b1" BorderBrush="WhiteSmoke" >
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="2"/>
                                </Grid.RowDefinitions>
                                <ContentPresenter ContentSource="Content" />
                                <Rectangle HorizontalAlignment="Stretch"
                                           x:Name="UnderLine"                                      
                                           Grid.Row="1"
                                           Fill="{TemplateBinding Foreground}" 
                                           Height="{Binding FontSize,  Converter={StaticResource MathConverter}, ConverterParameter=x/16, RelativeSource={RelativeSource Mode=TemplatedParent}}" >
                                    <Rectangle.Opacity>
                                        <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x ? 0 : y">
                                            <Binding RelativeSource="{RelativeSource Mode=TemplatedParent}" Path="IsInEditMode"></Binding>
                                            <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                                        </MultiBinding>
                                    </Rectangle.Opacity>
                                </Rectangle>            
                            </Grid>
                                             
                        </Border>
                        <Border  Grid.Column="0" x:Name="editpath"   Width="{Binding FontSize,  Converter={StaticResource MathConverter}, ConverterParameter=x, RelativeSource={RelativeSource Mode=TemplatedParent}}" >
                            <Border.Opacity>
                                <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x ? 0 : y">
                                    <Binding RelativeSource="{RelativeSource Mode=TemplatedParent}" Path="IsInEditMode"></Binding>
                                    <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                                </MultiBinding>
                            </Border.Opacity>
                            <Border.Visibility>
                                <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x ? 'Collapsed' : 'Visible'">
                                    <Binding RelativeSource="{RelativeSource Mode=TemplatedParent}" Path="IsInEditMode"></Binding>
                                </MultiBinding>
                            </Border.Visibility>
                            <Path Data="{StaticResource Edit}"  Stretch="Uniform"  VerticalAlignment="Center" Margin="0,0,0,0">
                                <Path.Style>
                                    <Style TargetType="{x:Type Path}">
                                        <Setter Property="Fill" Value="{Binding Foreground, RelativeSource={RelativeSource Mode=TemplatedParent}}"></Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Fill" Value="CadetBlue" />
                                                <Setter Property="Stroke" Value="Blue" />
                                                <!--<Setter TargetName="ButtonPath" Property="Stroke" Value="{Binding HoverForegroundBrush, RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                                <!--<Setter TargetName="ButtonPath" Property="Fill" Value="{StaticResource HoverForegroundBrush}" />-->
                                            </Trigger>

                                            <Trigger Property="IsEnabled" Value="false">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>

                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="PreviewMouseDown">   
                                    <i:ChangePropertyAction TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" PropertyName="IsInEditMode" Value="True"></i:ChangePropertyAction>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>                         
                        </Border>

                        <Border CornerRadius="100" Grid.Column="2" x:Name="cancelpath" 
                                
                                Width="{Binding FontSize,  Converter={StaticResource MathConverter}, ConverterParameter=x, RelativeSource={RelativeSource Mode=TemplatedParent}}" >
                            <Border.Visibility>
                                <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x ? 'Visible' : 'Collapsed'">
                                    <Binding RelativeSource="{RelativeSource Mode=TemplatedParent}" Path="IsInEditMode"></Binding>
                                </MultiBinding>
                            </Border.Visibility>                           
                            
                            <Path x:Name="cross" Data="{StaticResource Cross}" 
                                  StrokeThickness="{Binding FontSize,  Converter={StaticResource MathConverter}, ConverterParameter=x/6, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                  Stretch="Uniform"  
                                  VerticalAlignment="Center"
                                  Margin="0,0,0,0">
                                <Path.Style>
                                    <Style TargetType="{x:Type Path}">
                                        <Setter Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource Mode=TemplatedParent}}"></Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Stroke" Value="Orange" />
                                                <!--<Setter TargetName="ButtonPath" Property="Stroke" Value="{Binding HoverForegroundBrush, RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                                <!--<Setter TargetName="ButtonPath" Property="Fill" Value="{StaticResource HoverForegroundBrush}" />-->
                                            </Trigger>

                                            <Trigger Property="IsEnabled" Value="false">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                            
         

                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="PreviewMouseUp">
                                    <ex:ChangeKeyboardFocus TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"></ex:ChangeKeyboardFocus>
                                    <!--<i:ChangePropertyAction TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" PropertyName="Text" Value="{x:Null}"></i:ChangePropertyAction>
                                    <i:ChangePropertyAction TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" PropertyName="IsInEditMode" Value="false"></i:ChangePropertyAction>-->
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                   
                          

                            <!--<Trigger Property="IsPressed" Value="true">
                                --><!--<Setter TargetName="backgroundEllipse" Property="Fill" Value="{StaticResource PressedBackgroundBrush}" />--><!--
                                <Setter TargetName="backgroundEllipse" Property="Stroke" Value="{Binding PressedBackgroundBrush, RelativeSource={RelativeSource Mode=TemplatedParent}}" />
                                <Setter TargetName="ButtonPath" Property="Stroke" Value="{Binding PressedForegroundBrush, RelativeSource={RelativeSource Mode=TemplatedParent}}" />
                            </Trigger>-->
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <EventTrigger RoutedEvent="MouseEnter">
                            <BeginStoryboard>
                                <Storyboard >
                                    <DoubleAnimation Storyboard.TargetName="Var_Animation_0to1" Storyboard.TargetProperty="Width" To="1" Duration="0:0:0.5" />     
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                        <EventTrigger RoutedEvent="MouseLeave">
                            <BeginStoryboard >
                                <Storyboard >
                                    <DoubleAnimation Storyboard.TargetName="Var_Animation_0to1" Storyboard.TargetProperty="Width" To="0" Duration="0:0:0.5" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

    </Style>
</ResourceDictionary>