<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:pt1="clr-namespace:PropertyTools.Wpf"
    xmlns:local="clr-namespace:Utility.WPF.Controls.Base" 
    xmlns:enms="clr-namespace:Utility.Enums;assembly=Utility.Enums"
    xmlns:att="http://schemas.utility.com/attached"
    xmlns:res="http://schemas.utility.com/resourcedictionary"
    xmlns:conv="converter" 
    xmlns:mvvm="http://hexinnovation.com/math">

    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <mvvm:MathConverter x:Key="MathConverter"/>

    <Path x:Key="RightArrow" x:Shared="False"  StrokeEndLineCap="Round"  Stretch="Uniform" Stroke="Black" StrokeThickness="2" >
        <Path.Data>
            <PathGeometry>
                <PathGeometry.Figures>
                    <PathFigure StartPoint="0,0.5">
                        <LineSegment Point="1,0.5" />
                    </PathFigure>
                    <PathFigure StartPoint="0.5,0">
                        <LineSegment Point="1,0.5" />
                    </PathFigure>
                    <PathFigure StartPoint="0.5,1" >
                        <LineSegment Point="1,0.5" />
                    </PathFigure>
                </PathGeometry.Figures>
            </PathGeometry>
        </Path.Data>
    </Path>
    
    <Storyboard x:Key="Storyboard1">
        <DoubleAnimation 
                                    Storyboard.TargetName="Var_Animation_0to1"
                                    Storyboard.TargetProperty="Width"
                                Duration="0:0:1.5"
                                    From="0.0" To="1.0" 
                                    />
    </Storyboard>

    <Storyboard x:Key="Storyboard2">
        <DoubleAnimation 
                                    Storyboard.TargetName="Var_Animation_0to1"
                                    Storyboard.TargetProperty="Width"
                                Duration="0:0:1.5"
                                    From="1.0" To="0.0" 
                                    />
    </Storyboard>
    


    <ControlTemplate  x:Key="LeftToRight" TargetType="{x:Type HeaderedContentControl}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>


            <FrameworkElement x:Name="Var_Animation_0to1" Width="0">
                <FrameworkElement.Height>
                    <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x*y">
                        <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                        <Binding Path="(att:Ex.Indent).Value" RelativeSource="{RelativeSource Mode=TemplatedParent}"/>
                    </MultiBinding>
                </FrameworkElement.Height>
            </FrameworkElement>


            <ContentPresenter ContentSource="Content" x:Name="PART_ContentPresenter"/>

            <ToggleButton x:Name="hider"                           
                          Style="{Binding Path=(att:Ex.ToggleStyle), RelativeSource={RelativeSource Mode=TemplatedParent}}" 
                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}">
                <ToggleButton.LayoutTransform>
                    <RotateTransform Angle="180"/>
                </ToggleButton.LayoutTransform>
            </ToggleButton>

            <Grid Grid.Column="1"  >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="{Binding ElementName=Var_Animation_0to1, Path=Height}" MinWidth="10" />
                </Grid.ColumnDefinitions>
                <GridSplitter x:Name="_splitter" Grid.Column="0" Width="4" VerticalAlignment="Stretch" HorizontalAlignment="Center" Background="#BFDBFF"  ResizeBehavior="CurrentAndNext"     />
                <ContentPresenter  ContentSource="Header" Grid.Column="1" x:Name="PART_HeaderPresenter" />
            </Grid>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding Path=(att:Ex.Reverse), RelativeSource={RelativeSource Mode=Self} }" Value="True">
                <Setter TargetName="PART_ContentPresenter" Property="Content" >
                    <Setter.Value>
                        <Binding Path="Header" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_ContentPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="HeaderTemplate" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_ContentPresenter" Property="ContentTemplateSelector" >
                    <Setter.Value>
                        <Binding Path="HeaderTemplateSelector" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>

                <Setter TargetName="PART_HeaderPresenter" Property="Content" >
                    <Setter.Value>
                        <Binding Path="Content" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_HeaderPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="ContentTemplate" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_HeaderPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="ContentTemplateSelector" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                <Setter Property="att:Ex.IsChecked" Value="True" />
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard1}"/>
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="0"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard2}"/>
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="hider"
                                             Duration="0:0:0.5"
                                                 To="180"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.ExitActions>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>


    <ControlTemplate  x:Key="RightToLeft" TargetType="{x:Type HeaderedContentControl}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>


            <FrameworkElement x:Name="Var_Animation_0to1" Width="0">
                <FrameworkElement.Height>
                    <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x*y">
                        <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                        <Binding Path="(att:Ex.Indent).Value" RelativeSource="{RelativeSource Mode=TemplatedParent}"/>
                    </MultiBinding>
                </FrameworkElement.Height>
            </FrameworkElement>


            <Grid Grid.Column="0" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{Binding ElementName=Var_Animation_0to1, Path=Height}" MinWidth="10" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <ContentPresenter ContentSource="Header" Grid.Column="0" x:Name="PART_HeaderPresenter" />
                <GridSplitter x:Name="_splitter" Grid.Column="1" Width="4" VerticalAlignment="Stretch" HorizontalAlignment="Center" Background="#BFDBFF"
                    ResizeBehavior="PreviousAndCurrent"     />
            </Grid>

            <ContentPresenter ContentSource="Content" Grid.Column="1" x:Name="PART_ContentPresenter"/>
            <ToggleButton x:Name="hider"  
                          Grid.Column="1"
                           Style="{Binding Path=(att:Ex.ToggleStyle), RelativeSource={RelativeSource Mode=TemplatedParent}}"                    
                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}">
                <ToggleButton.LayoutTransform>
                    <RotateTransform Angle="0"/>
                </ToggleButton.LayoutTransform>

            </ToggleButton>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding Path=(att:Ex.Reverse), RelativeSource={RelativeSource Mode=Self} }" Value="True">
                <Setter TargetName="PART_ContentPresenter" Property="Content" >
                    <Setter.Value>
                        <Binding Path="Header" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_ContentPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="HeaderTemplate" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_ContentPresenter" Property="ContentTemplateSelector" >
                    <Setter.Value>
                        <Binding Path="HeaderTemplateSelector" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>

                <Setter TargetName="PART_HeaderPresenter" Property="Content" >
                    <Setter.Value>
                        <Binding Path="Content" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_HeaderPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="ContentTemplate" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="PART_HeaderPresenter" Property="ContentTemplate" >
                    <Setter.Value>
                        <Binding Path="ContentTemplateSelector" RelativeSource="{RelativeSource AncestorType=HeaderedContentControl}"></Binding>
                    </Setter.Value>
                </Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                <Setter Property="att:Ex.IsChecked" Value="True" />
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard1}"/>
                    <BeginStoryboard>                
                        <Storyboard Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="180"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard2}"/>
                    <BeginStoryboard>
                        <Storyboard  Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="0"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.ExitActions>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>


    <ControlTemplate x:Key="TopToBottom" TargetType="{x:Type HeaderedContentControl}">
        <Grid>
            
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>


            <FrameworkElement x:Name="Var_Animation_0to1" Width="0">
                <FrameworkElement.Height>
                    <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x*y">
                        <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                        <Binding Path="(att:Ex.Indent).Value" RelativeSource="{RelativeSource Mode=TemplatedParent}"/>
                    </MultiBinding>
                </FrameworkElement.Height>
            </FrameworkElement>

            <ContentPresenter ContentSource="Content"/>

            <ToggleButton x:Name="hider"                              
                          Style="{Binding Path=(att:Ex.ToggleStyle), RelativeSource={RelativeSource Mode=TemplatedParent}}" 
                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}">
                <ToggleButton.LayoutTransform>
                    <RotateTransform Angle="270"/>
                </ToggleButton.LayoutTransform>
            </ToggleButton>

            <Grid Grid.Row="1" >

                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition Height="{Binding ElementName=Var_Animation_0to1, Path=Height}" MinHeight="10" />
                </Grid.RowDefinitions>
                <GridSplitter x:Name="_splitter" Grid.Row="0" Height="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="#BFDBFF" ResizeBehavior="CurrentAndNext"    />
                <ContentPresenter ContentSource="Header" Grid.Row="1" x:Name="PART_HeaderPresenter"                                    />
            </Grid>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                <Setter Property="att:Ex.IsChecked" Value="True" />
                <DataTrigger.EnterActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard1}"/>
                    <BeginStoryboard>
                        <Storyboard  Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="90"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                    <BeginStoryboard Storyboard="{StaticResource Storyboard2}"/>
                    <BeginStoryboard>
                        <Storyboard  Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="270"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.ExitActions>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>



    <ControlTemplate x:Key="BottomToTop" TargetType="{x:Type HeaderedContentControl}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <FrameworkElement x:Name="Var_Animation_0to1" Width="0">
                <FrameworkElement.Height>
                    <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="x*y">
                        <Binding ElementName="Var_Animation_0to1" Path="Width"/>
                        <Binding Path="(att:Ex.Indent).Value" RelativeSource="{RelativeSource Mode=TemplatedParent}"/>
                    </MultiBinding>
                </FrameworkElement.Height>
            </FrameworkElement>
            
            <Grid Grid.Row="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="{Binding ElementName=Var_Animation_0to1, Path=Height}" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <ContentPresenter ContentSource="Header"
                                  Grid.Row="0"
                                  x:Name="PART_HeaderPresenter" 
                                  />

                <GridSplitter x:Name="_splitter" Grid.Row="1" Height="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="#BFDBFF"
                          ResizeBehavior="PreviousAndCurrent"/>
            </Grid>

            <ContentPresenter ContentSource="Content" Grid.Row="1"/>
            
            <ToggleButton x:Name="hider"  Grid.Row="1"
                          Style="{Binding Path=(att:Ex.ToggleStyle), RelativeSource={RelativeSource Mode=TemplatedParent}}" 
                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}">
                <ToggleButton.LayoutTransform>
                    <RotateTransform Angle="90"/>
                </ToggleButton.LayoutTransform>
            </ToggleButton>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                <Setter Property="att:Ex.IsChecked" Value="True" />
                
                <DataTrigger.EnterActions>
                    <BeginStoryboard>
                        <StaticResource ResourceKey="Storyboard1"></StaticResource>
                    </BeginStoryboard>
                    
                    <BeginStoryboard>
                        <Storyboard  Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="270"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                    <BeginStoryboard>
                        <StaticResource ResourceKey="Storyboard2"></StaticResource>
                    </BeginStoryboard>
                    <BeginStoryboard>
                        <Storyboard Storyboard.TargetName="hider">
                            <DoubleAnimation Duration="0:0:0.5"
                                                 To="90"
                                                 Storyboard.TargetProperty="(LayoutTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.ExitActions>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>


    <Style x:Key="ArrowToggleButton" TargetType="{x:Type ToggleButton}">
        <Setter Property="Margin" Value="0,2,2,0"></Setter>
        <Setter Property="Height" Value="16"></Setter>
        <Setter Property="Width" Value="16"></Setter>
        <Setter Property="Background" Value="Transparent"></Setter>
        <Setter Property="BorderThickness" Value="0"></Setter>
        <Setter Property="Content" Value="{StaticResource RightArrow}"/>
    </Style>

    <Style TargetType="{x:Type local:SplitControl}" BasedOn="{StaticResource {x:Type HeaderedContentControl}}">
        <Setter Property="att:Ex.IsChecked" Value="False"/>
        <Setter Property="att:Ex.Indent" Value="150"/>
        <Setter Property="att:Ex.ToggleStyle" Value="{StaticResource ArrowToggleButton}"/>
        <Setter Property="Background" Value="Transparent"></Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:SplitControl}">
                    <DockPanel x:Name="PART_DockPanel" 
                               LastChildFill="True"
                               Background="{TemplateBinding Background}">
                        <ContentPresenter  x:Name="PART_ContentPresenter" />

                        <ContentPresenter ContentSource="Header" x:Name="PART_HeaderPresenter" />
                    </DockPanel>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <Trigger Property="Movement" Value="{x:Static enms:XYMovement.BottomToTop}">
                <Setter Property="Template"  Value="{StaticResource BottomToTop}"/>
                <Setter Property="HorizontalContentAlignment" Value="Right"></Setter>
                <Setter Property="VerticalContentAlignment" Value="Top"></Setter>
            </Trigger>
            <Trigger Property="Movement" Value="{x:Static enms:XYMovement.TopToBottom}">
                <Setter Property="Template"  Value="{StaticResource TopToBottom}"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"></Setter>
                <Setter Property="VerticalContentAlignment" Value="Bottom"></Setter>
            </Trigger>
            <Trigger Property="Movement" Value="{x:Static enms:XYMovement.RightToLeft}">
                <Setter Property="Template"  Value="{StaticResource RightToLeft}"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"></Setter>
                <Setter Property="VerticalContentAlignment" Value="Top"></Setter>
            </Trigger>
            <Trigger Property="Movement" Value="{x:Static enms:XYMovement.LeftToRight}">
                <Setter Property="Template"  Value="{StaticResource LeftToRight}"/>
                <Setter Property="HorizontalContentAlignment" Value="Right"></Setter>
                <Setter Property="VerticalContentAlignment" Value="Top"></Setter>
            </Trigger>
        </Style.Triggers>
    </Style>


</ResourceDictionary>