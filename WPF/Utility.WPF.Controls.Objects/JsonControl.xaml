<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:beh="http://schemas.utility.com/behaviors"
    xmlns:jlinq="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json"
    xmlns:controls="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:conv="http://schemas.utility.com/converters"
    xmlns:local="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:c="http://schemas.utility.com"
    xmlns:res="http://schemas.utility.com/resourcedictionary">

    <ResourceDictionary.MergedDictionaries>
        <res:SharedResourceDictionary  Source="/Utility.WPF.Geometries;component/Resources.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <local:EnumConverter x:Key="EnumConverter"></local:EnumConverter>

    <ObjectDataProvider
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        x:Key="MyEnumValues"
        MethodName="GetValues"
        ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type xmlns:json="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json" TypeName="json:JTokenType" />
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>

    <ItemsControl x:Key="ItemsControlToolTip" ItemsSource="{Binding Source={StaticResource MyEnumValues}}">
        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type jlinq:JTokenType}">
                <Border
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Border.BorderBrush>
                    <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                        <Label.Background>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Label.Background>
                    </Label>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <WrapPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
    </ItemsControl>

    <Style x:Key="TokenToolTipStyle" TargetType="{x:Type ToolTip}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="HasDropShadow" Value="True"/>
        <Setter Property="DataContext" Value="{Binding Path=PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolTip">
                    <Border DataContext="{Binding Value.Type, Mode=OneWay}"
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                        <Border.BorderBrush>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Border.BorderBrush>
                        <StackPanel>
                            <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                                <Label.Background>
                                    <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                                </Label.Background>
                                <Label.Triggers>
                                    <EventTrigger RoutedEvent="Control.Loaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:2" Value="True" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="Control.Unloaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Label.Triggers>
                            </Label>
                            <Popup x:Name="PopupOnHover"
                                   Placement="Bottom"      
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide" Child="{StaticResource ItemsControlToolTip}">
                            </Popup>
                        </StackPanel>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <ToolTip x:Key="TokenToolTip" Style="{StaticResource TokenToolTipStyle}"/>

    <Style x:Key="JsonTreeViewItem" TargetType="{x:Type TreeViewItem}">
        <Setter Property="IsExpanded" Value="True" />
    </Style>

    <controls:JsonObjectTypeTemplateSelector x:Key="JsonObjectTypeTemplateSelector" />



    <Style TargetType="{x:Type controls:JsonControl}" BasedOn="{StaticResource {x:Type TreeView}}">
        <Setter Property="IsTextSearchEnabled" Value="True" />
        <!--<Setter Property="ItemTemplateSelector" Value="{x:Static controls:TemplateSelector.JPropertyDataTemplateSelector}" />-->
        <Setter Property="ItemTemplateSelector" Value="{StaticResource JsonObjectTypeTemplateSelector}" />
        <Setter Property="ItemContainerStyle" Value="{StaticResource JsonTreeViewItem}" />
        <Setter Property="Background" Value="#FFF9F9F9"></Setter>
        <Style.Resources>

            <Style x:Key="LabelValue"  TargetType="ItemsControl">
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <Grid  Margin="0,2,0,2"   HorizontalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"></ColumnDefinition>
                                    <ColumnDefinition Width="10"></ColumnDefinition>
                                    <ColumnDefinition Width="400"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                            </Grid>
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelStyle"  TargetType="TextBlock">
                <Setter Property="Opacity" Value="0.9"></Setter>
                <Setter Property="HorizontalAlignment" Value="Right"></Setter>
                <Setter Property="FontWeight" Value="DemiBold"></Setter>
                <Setter Property="ToolTip" Value="{StaticResource TokenToolTip}"></Setter>
                <Setter Property="ToolTipService.InitialShowDelay" Value="300"></Setter>
                <Setter Property="Text" Value="{Binding Path=Name, Mode=OneWay}"></Setter>
                <Setter Property="Foreground">
                    <Setter.Value>
                        <SolidColorBrush Color="{Binding Path=Value.Type, Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelValueContent" TargetType="ContentControl">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <ItemsControl Style="{StaticResource LabelValue}" >
                                <TextBlock Style="{StaticResource LabelStyle}" />
                                <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->
                                <ContentPresenter           Grid.Column="2">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseLeftButtonDown">
                                            <i:InvokeCommandAction Command="{x:Static controls:Commands.FooCommand}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </ContentPresenter>
                            </ItemsControl>
                        </ControlTemplate>

                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate x:Key="PrimitivePropertyTemplate" DataType="{x:Type jlinq:JProperty}">
                <Grid  Margin="0,2,0,2"   HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"></ColumnDefinition>
                        <ColumnDefinition Width="10"></ColumnDefinition>
                        <ColumnDefinition Width="400"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="DemiBold"
                        ToolTip="{StaticResource ItemsControlToolTip}"
                        ToolTipService.InitialShowDelay="300"
                        Text="{Binding Path=Name, Mode=OneWay}" >
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="{Binding Path=Value.Type, Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </TextBlock.Foreground>
                    </TextBlock>

                    <Border BorderThickness="0,0,0,1"                      
                            Background="White"
                            BorderBrush="Black"
                            HorizontalAlignment="Stretch"
                            SnapsToDevicePixels="True">
                        <TextBlock
                            HorizontalAlignment="Left"
                            Text="{Binding Value, Mode=TwoWay, Converter={x:Static controls:Converters.JTokenConverter}}"
                            TextWrapping="Wrap">
                        </TextBlock>
                    </Border>
                </Grid>
            </DataTemplate>

            <Style x:Key="BasicButtonStyle" TargetType="{x:Type Button}">
                <Setter Property="Background" Value="Transparent"></Setter>
                <Setter Property="BorderBrush" Value="Transparent"></Setter>
                <Setter Property="Height" Value="16"></Setter>
                <Setter Property="Width" Value="16"></Setter>
            </Style>

            <!--<HierarchicalDataTemplate DataType="{x:Type jlinq:JObject}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
            </HierarchicalDataTemplate>-->

            <!--<HierarchicalDataTemplate DataType="{x:Type jlinq:JConstructor}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Constructor" />
            </HierarchicalDataTemplate>
            <HierarchicalDataTemplate DataType="{x:Type jlinq:JRaw}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Raw" />
            </HierarchicalDataTemplate>
            -->

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JArray}" x:Key="ArrayPropertyTemplate" ItemsSource="{Binding .}" >
                <Grid>
                    <Button Style="{StaticResource BasicButtonStyle}" Command="{Binding Source={x:Static local:Commands.FooCommand}}">
                        <Path  Stroke="Gray" StrokeThickness="2"   Stretch="UniformToFill" Data="{StaticResource Plus}"/>
                    </Button>
                </Grid>
            </HierarchicalDataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JObject}" x:Key="ObjectPropertyTemplate" ItemsSource="{Binding ., Converter={x:Static controls:ComplexPropertyMethodValueConverter.Instance}, ConverterParameter='Children'}">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <Grid>
                        <Button Style="{StaticResource BasicButtonStyle}" HorizontalAlignment="Right" Command="{Binding Source={x:Static local:Commands.UnFooCommand}}">
                            <Path  Stroke="Gray" StrokeThickness="2"  Stretch="UniformToFill" Data="{StaticResource Cross}"/>
                        </Button>
                    </Grid>
                </ContentControl>
            </HierarchicalDataTemplate>

            <!--<VisibilityConverter x:Key="VisibilityConverter" />-->
            <controls:NumberConverter x:Key="NumberConverter" />
            <controls:GuidConverter x:Key="GuidConverter" />
            <controls:IntegerConverter x:Key="IntegerConverter" />
            <controls:IndexConverter x:Key="IndexConverter" />
            <controls:TimeConverter x:Key="TimeConverter" />
            <controls:DateConverter x:Key="DateConverter" />
            <controls:DateTimeConverter x:Key="DateTimeConverter" />
            <controls:DecimalUpDownRangeConverter x:Key="DecimalUpDownRangeConverter" />
            <!--<controls:IntegerUpDownRangeConverter x:Key="IntegerUpDownRangeConverter" />-->
            <controls:EnumToNumberConverter x:Key="EnumToNumberConverter" />
            <controls:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
            <controls:NullableToVisibilityConverter x:Key="NullableToVisibilityConverter" />
            <controls:BooleanToNullConverter x:Key="BooleanToNullConverter" />
            <controls:SchemaNullableToVisibilityConverter x:Key="SchemaNullableToVisibilityConverter" />
            <controls:SchemaNullableToBooleanConverter x:Key="SchemaNullableToBooleanConverter" />
            <controls:EventArgsConverter x:Key="EventArgsConverter" />

            <DataTemplate x:Key="TypeTemplate">
                <c:BreadCrumbs ItemsSource="{Binding Value.Value, Converter={x:Static conv:TypeHierarchyConverter.Instance}}"/>
            </DataTemplate>

            <DataTemplate x:Key="StringTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->

                    <Border BorderThickness="0,0,0,1"
                            Grid.Column="2"
                            Background="White"
                            BorderBrush="Black"
                            HorizontalAlignment="Stretch"
                            SnapsToDevicePixels="True">
                        <TextBox    
                            x:Name="TextBox"
                            TextAlignment="Left"
                            HorizontalAlignment="Stretch"
                            Text="{Binding Value, Mode=TwoWay, Converter={x:Static controls:JTokenConverter.Instance}}"
                            TextWrapping="Wrap">
                            <i:Interaction.Triggers>
                                <!--<i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:InvokeCommandAction Command="{x:Static controls:Commands.FooCommand}" />
                                </i:EventTrigger>-->
                                <i:EventTrigger EventName="LostFocus">
                                    <i:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </TextBox>
                    </Border>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="DateTimeTemplate">
                <UniformGrid Rows="1">
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <xctk:DateTimePicker Margin="0,0,0,8" TextAlignment="Left" AutoCloseCalendar="True"
                                         Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateTimeConverter}}" />
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="DateTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel>
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <xctk:DateTimePicker Margin="0,0,0,8" TextAlignment="Left" Format="LongDate" 
                                         TimePickerVisibility="Collapsed" TimeFormat="Custom" AutoCloseCalendar="True"
                                         Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateConverter}}" >
                        <i:Interaction.Triggers>
                            <i:PropertyChangedTrigger Binding="{Binding Path=Value, Mode=OneWayToSource}">
                                <i:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                            </i:PropertyChangedTrigger>
                        </i:Interaction.Triggers>
                    </xctk:DateTimePicker>
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="TimeTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <xctk:TimePicker Margin="0,0,0,8" HorizontalAlignment="Stretch" 
                                     Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource TimeConverter}}" />
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="NumberTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <xctk:DoubleUpDown Margin="0,0,0,8" TextAlignment="Left" Value="{Binding Value, Converter={StaticResource NumberConverter}}">
                        <i:Interaction.Triggers>
                            <i:PropertyChangedTrigger Binding="{Binding Path=Value, Mode=OneWayToSource}">
                                <i:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                            </i:PropertyChangedTrigger>
                        </i:Interaction.Triggers>
                    </xctk:DoubleUpDown>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="IntegerTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <WrapPanel>
                        <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"  x:Name="IntegerUpDown"               
                                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource IntegerConverter}}">
                            <i:Interaction.Triggers>
                                <i:PropertyChangedTrigger Binding="{Binding ElementName=IntegerUpDown, Path=Value}">
                                    <i:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                                </i:PropertyChangedTrigger>
                            </i:Interaction.Triggers>
                        </xctk:IntegerUpDown>
                    </WrapPanel>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="GuidTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <TextBox Margin="10" Text="{Binding Value, Mode=TwoWay,Converter={StaticResource GuidConverter}}" Grid.Column="2" Width="244" Height="20">
                        <i:Interaction.Behaviors>
                            <beh:GuidEditBehavior />
                        </i:Interaction.Behaviors>
                    </TextBox>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="IntegerNullTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"                                   
                                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource IntegerConverter}}"
                                        Visibility="{Binding HasValue,Converter={StaticResource VisibilityConverter}}"/>
                        <ToggleButton Content="Null" >
                            <ToggleButton.IsChecked>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="." Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </WrapPanel>
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="EnumTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <ComboBox >
                        <ComboBox.DataContext>
                            <MultiBinding Converter="{StaticResource EnumConverter}">
                                <Binding Path="." Mode="OneWay"/>
                                <Binding Path="Name" Mode="OneWay"/>
                                <Binding Path="Value.Value" Mode="OneWay"/>
                                <!--<Binding Path="Schema" Mode="OneWay" RelativeSource="{RelativeSource AncestorType=TreeView}"/>-->
                            </MultiBinding>
                        </ComboBox.DataContext>
                        <i:Interaction.Behaviors>
                            <beh:EnumComboBehavior  Value="{Binding Value, Mode=TwoWay}">
                            </beh:EnumComboBehavior>
                        </i:Interaction.Behaviors>
                    </ComboBox>
                </ContentControl>

            </DataTemplate>
            <DataTemplate x:Key="NullTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource Null}"/>
                </ContentControl>
            </DataTemplate>
            <!--<DataTemplate x:Key="EnumNullTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <ToggleButton Content="Null" >
                            <ToggleButton.IsChecked>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="Schema.OneOf[1].ActualSchema" Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </WrapPanel>
                </UniformGrid>
            </DataTemplate>-->
            <DataTemplate x:Key="BooleanTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <CheckBox IsChecked="{Binding Value, Mode=TwoWay, FallbackValue=false}" Margin="0,0,0,8" />
                </ContentControl>
            </DataTemplate>
        </Style.Resources>
    </Style>

</ResourceDictionary>