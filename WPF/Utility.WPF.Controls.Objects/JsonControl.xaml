<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:beh="http://schemas.utility.com/behaviors"
    xmlns:jlinq="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json"
    xmlns:controls="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:conv="http://schemas.utility.com/converters"
    xmlns:local="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:c="http://schemas.utility.com">

    <local:EnumConverter x:Key="EnumConverter"></local:EnumConverter>
    
    <ObjectDataProvider
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        x:Key="MyEnumValues"
        MethodName="GetValues"
        ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type xmlns:json="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json" TypeName="json:JTokenType" />
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>

    <ItemsControl x:Key="ItemsControlToolTip" ItemsSource="{Binding Source={StaticResource MyEnumValues}}">
        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type jlinq:JTokenType}">
                <Border
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Border.BorderBrush>
                    <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                        <Label.Background>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Label.Background>
                    </Label>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <WrapPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
    </ItemsControl>

    <Style x:Key="TokenToolTipStyle" TargetType="{x:Type ToolTip}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="HasDropShadow" Value="True"/>
        <Setter Property="DataContext" Value="{Binding Path=PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolTip">
                    <Border DataContext="{Binding Value.Type, Mode=OneWay}"
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                        <Border.BorderBrush>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Border.BorderBrush>
                        <StackPanel>
                            <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                                <Label.Background>
                                    <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                                </Label.Background>
                                <Label.Triggers>
                                    <EventTrigger RoutedEvent="Control.Loaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:2" Value="True" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="Control.Unloaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Label.Triggers>                          
                            </Label>
                            <Popup x:Name="PopupOnHover"
                                   Placement="Bottom"      
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide" Child="{StaticResource ItemsControlToolTip}">
                            </Popup>
                        </StackPanel>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <ToolTip x:Key="TokenToolTip" Style="{StaticResource TokenToolTipStyle}"/>

    <Style x:Key="JsonTreeViewItem" TargetType="{x:Type TreeViewItem}">
        <Setter Property="IsExpanded" Value="True" />
    </Style>

    <controls:JsonObjectTypeTemplateSelector x:Key="JsonObjectTypeTemplateSelector" />



    <Style TargetType="{x:Type controls:JsonControl}" BasedOn="{StaticResource {x:Type TreeView}}">
        <Setter Property="IsTextSearchEnabled" Value="True" />
        <!--<Setter Property="ItemTemplateSelector" Value="{x:Static controls:TemplateSelector.JPropertyDataTemplateSelector}" />-->
        <Setter Property="ItemTemplateSelector" Value="{StaticResource JsonObjectTypeTemplateSelector}" />
        <Setter Property="ItemContainerStyle" Value="{StaticResource JsonTreeViewItem}" />
        <Setter Property="Background" Value="#FFF9F9F9"></Setter>
        <Style.Resources>

            <Style x:Key="LabelValue"  TargetType="ItemsControl">
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <Grid  Margin="0,2,0,2"   HorizontalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"></ColumnDefinition>
                                    <ColumnDefinition Width="10"></ColumnDefinition>
                                    <ColumnDefinition Width="400"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                            </Grid>
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelStyle"  TargetType="TextBlock">
                <Setter Property="Opacity" Value="0.9"></Setter>
                <Setter Property="HorizontalAlignment" Value="Right"></Setter>
                <Setter Property="FontWeight" Value="DemiBold"></Setter>
                <Setter Property="ToolTip" Value="{StaticResource TokenToolTip}"></Setter>
                <Setter Property="ToolTipService.InitialShowDelay" Value="300"></Setter>
                <Setter Property="Text" Value="{Binding Path=Name, Mode=OneWay}"></Setter>
                <Setter Property="Foreground">
                    <Setter.Value>
                        <SolidColorBrush Color="{Binding Path=Value.Type, Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelValueContent" TargetType="ContentControl">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <ItemsControl Style="{StaticResource LabelValue}" >
                                <TextBlock Style="{StaticResource LabelStyle}" />
                                <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->
                                <ContentPresenter           Grid.Column="2">
                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="MouseLeftButtonDown">
                                            <b:InvokeCommandAction Command="{x:Static controls:Commands.FooCommand}" />
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>
                                </ContentPresenter>
                            </ItemsControl>
                        </ControlTemplate>

                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate x:Key="PrimitivePropertyTemplate" DataType="{x:Type jlinq:JProperty}">
                <Grid  Margin="0,2,0,2"   HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"></ColumnDefinition>
                        <ColumnDefinition Width="10"></ColumnDefinition>
                        <ColumnDefinition Width="400"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        HorizontalAlignment="Right"
                        FontWeight="DemiBold"
                        ToolTip="{StaticResource ItemsControlToolTip}"
                        ToolTipService.InitialShowDelay="300"
                        Text="{Binding Path=Name, Mode=OneWay}" >
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="{Binding Path=Value.Type, Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </TextBlock.Foreground>
                    </TextBlock>

                    <Border BorderThickness="0,0,0,1"                      
                            Background="White"
                            BorderBrush="Black"
                            HorizontalAlignment="Stretch"
                            SnapsToDevicePixels="True">
                        <TextBlock
                            HorizontalAlignment="Left"
                            Text="{Binding Value, Converter={x:Static controls:Converters.JTokenConverter}}"
                            TextWrapping="Wrap">
                        </TextBlock>
                    </Border>
                </Grid>
            </DataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JObject}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
            </HierarchicalDataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JConstructor}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Constructor" />
            </HierarchicalDataTemplate>
            <HierarchicalDataTemplate DataType="{x:Type jlinq:JRaw}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Raw" />
            </HierarchicalDataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JArray}"  ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}"/>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JProperty}" x:Key="ArrayPropertyTemplate" ItemsSource="{Binding Value}" />

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JObject}" x:Key="ObjectPropertyTemplate" ItemsSource="{Binding ., Converter={x:Static controls:ComplexPropertyMethodValueConverter.Instance}, ConverterParameter='Children'}">
                <ContentControl Style="{StaticResource LabelValueContent}"/>
            </HierarchicalDataTemplate>

            <!--<VisibilityConverter x:Key="VisibilityConverter" />-->
            <controls:NumberConverter x:Key="NumberConverter" />
            <controls:IntegerConverter x:Key="IntegerConverter" />
            <controls:IndexConverter x:Key="IndexConverter" />
            <controls:TimeConverter x:Key="TimeConverter" />
            <controls:DateConverter x:Key="DateConverter" />
            <controls:DateTimeConverter x:Key="DateTimeConverter" />
            <controls:DecimalUpDownRangeConverter x:Key="DecimalUpDownRangeConverter" />
            <controls:IntegerUpDownRangeConverter x:Key="IntegerUpDownRangeConverter" />
            <controls:EnumToNumberConverter x:Key="EnumToNumberConverter" />
            <controls:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
            <controls:NullableToVisibilityConverter x:Key="NullableToVisibilityConverter" />
            <controls:BooleanToNullConverter x:Key="BooleanToNullConverter" />
            <controls:SchemaNullableToVisibilityConverter x:Key="SchemaNullableToVisibilityConverter" />
            <controls:SchemaNullableToBooleanConverter x:Key="SchemaNullableToBooleanConverter" />

            <DataTemplate x:Key="TypeTemplate">
                <c:BreadCrumbs ItemsSource="{Binding Value.Value, Converter={x:Static conv:TypeHierarchyConverter.Instance}}"/>
            </DataTemplate>
            <DataTemplate x:Key="StringTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->

                    <Border BorderThickness="0,0,0,1"
                            Grid.Column="2"
                            Background="White"
                            BorderBrush="Black"
                            HorizontalAlignment="Stretch"
                            SnapsToDevicePixels="True">
                        <TextBox    
                            TextAlignment="Left"
                            HorizontalAlignment="Stretch"
                            Text="{Binding Value, Mode=TwoWay, Converter={x:Static controls:JTokenConverter.Instance}}"
                            TextWrapping="Wrap">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="MouseLeftButtonDown">
                                    <b:InvokeCommandAction Command="{x:Static controls:Commands.FooCommand}" />
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </TextBox>
                    </Border>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="DateTimeTemplate">
                <UniformGrid Rows="1">
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <xctk:DateTimePicker Margin="0,0,0,8" TextAlignment="Left" AutoCloseCalendar="True"
                                         Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateTimeConverter}}" />
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="DateTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel>
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <xctk:DateTimePicker Margin="0,0,0,8" TextAlignment="Left" Format="LongDate" 
                                         TimePickerVisibility="Collapsed" TimeFormat="Custom" AutoCloseCalendar="True"
                                         Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateConverter}}" />
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="TimeTemplate">
                <UniformGrid Rows="1">
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>

                    <xctk:TimePicker Margin="0,0,0,8" HorizontalAlignment="Stretch" 
                                     Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource TimeConverter}}" />
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="NumberTemplate">

                <ContentControl Style="{StaticResource LabelValueContent}">
                    <xctk:DoubleUpDown Margin="0,0,0,8" TextAlignment="Left"
                                       Minimum="{Binding Schema.Minimum, Converter={StaticResource DecimalUpDownRangeConverter}, ConverterParameter=min}"
                                       Maximum="{Binding Schema.Maximum, Converter={StaticResource DecimalUpDownRangeConverter}, ConverterParameter=max}"
                                       Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NumberConverter}}" />
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="IntegerTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <WrapPanel>
                        <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"
                                        Minimum="{Binding Schema.Minimum, Converter={StaticResource IntegerUpDownRangeConverter}, ConverterParameter=min}"
                                        Maximum="{Binding Schema.Maximum, Converter={StaticResource IntegerUpDownRangeConverter}, ConverterParameter=max}"
                                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource IntegerConverter}}"/>
                    </WrapPanel>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="IntegerNullTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"
                                        Minimum="{Binding Schema.Minimum, Converter={StaticResource IntegerUpDownRangeConverter}, ConverterParameter=min}"
                                        Maximum="{Binding Schema.Maximum, Converter={StaticResource IntegerUpDownRangeConverter}, ConverterParameter=max}"
                                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource IntegerConverter}}"
                                        Visibility="{Binding HasValue,Converter={StaticResource VisibilityConverter}}"/>
                        <ToggleButton Content="Null" Visibility="{Binding  Converter={StaticResource SchemaNullableToVisibilityConverter}, Mode=OneWay}">
                            <ToggleButton.IsChecked>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="." Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </WrapPanel>
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="EnumTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <ComboBox >
                        <ComboBox.DataContext>
                            <MultiBinding Converter="{StaticResource EnumConverter}">
                                <Binding Path="." Mode="OneWay"/>
                                <Binding Path="Name" Mode="OneWay"/>
                                <Binding Path="Value.Value" Mode="OneWay"/>
                                <Binding Path="Schema" Mode="OneWay" RelativeSource="{RelativeSource AncestorType=TreeView}"/>
                            </MultiBinding>                     
                        </ComboBox.DataContext>
                        <b:Interaction.Behaviors>
                            <beh:EnumComboBehavior  Value="{Binding Value, Mode=TwoWay}">                            
                            </beh:EnumComboBehavior>
                        </b:Interaction.Behaviors>
                    </ComboBox>
                </ContentControl>
                <!--<UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <ComboBox Margin="0,0,0,8" ItemsSource="{Binding Schema.ActualSchema.EnumerationNames}"                             >
                            <ComboBox.SelectedValue>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="Schema.ActualSchema" Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="EnumToNumberConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ComboBox.SelectedValue>
                        </ComboBox>

                    </WrapPanel>
                </UniformGrid>-->
            </DataTemplate>
            <DataTemplate x:Key="NullTemplate">
                <ContentControl Style="{StaticResource LabelValueContent}">
                    <!--<TextBlock>null</TextBlock>-->
                    <Path Stroke="Gray" StrokeThickness="2">
                        <Path.Data>
                            <GeometryGroup>
                                <EllipseGeometry Center="10,10" RadiusX="7.5" RadiusY="7.5" />
                                <LineGeometry StartPoint="0,20" EndPoint="20,0" />
                            </GeometryGroup>
                        </Path.Data>
                    </Path>
                </ContentControl>
            </DataTemplate>
            <DataTemplate x:Key="EnumNullTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <ToggleButton Content="Null" >
                            <ToggleButton.IsChecked>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="Schema.OneOf[1].ActualSchema" Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </WrapPanel>
                </UniformGrid>
            </DataTemplate>
            <DataTemplate x:Key="BooleanTemplate">
                <UniformGrid Rows="1"  >
                    <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    <CheckBox Content="{Binding Schema.Description}" 
                              IsThreeState="{Binding Schema.ActualSchema,Converter={StaticResource SchemaNullableToBooleanConverter}}"
                              IsChecked="{Binding Value, Mode=TwoWay, FallbackValue=false}" Margin="0,0,0,8" />
                </UniformGrid>
            </DataTemplate>
        </Style.Resources>
    </Style>

</ResourceDictionary>