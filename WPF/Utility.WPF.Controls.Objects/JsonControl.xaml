<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:beh="http://schemas.utility.com/behaviors"
    xmlns:jlinq="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json"
    xmlns:controls="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    xmlns:conv="http://schemas.utility.com/converters"
    xmlns:local="clr-namespace:Utility.WPF.Controls.Objects"
    xmlns:c="http://schemas.utility.com"
    xmlns:d="clr-namespace:NumericUpDownLib;assembly=NumericUpDownLib"
    xmlns:res="http://schemas.utility.com/resourcedictionary" 
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:att="http://schemas.utility.com/attached" 
    xmlns:hex="http://hexinnovation.com/math"
    xmlns:ad="http://schemas.utility.com/adorners">

    <ResourceDictionary.MergedDictionaries>
        <res:SharedResourceDictionary  Source="/Utility.WPF.Geometries;component/Resources.xaml" />
        <res:SharedResourceDictionary Source="/Utility.WPF.Controls.Objects;component/Themes/Dictionary1.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <sys:Boolean x:Key="True">True</sys:Boolean>
    <sys:Boolean x:Key="False">False</sys:Boolean>

    <local:EnumConverter x:Key="EnumConverter"></local:EnumConverter>
    <local:ToolTipTemplateSelector x:Key="ToolTipTemplateSelector"></local:ToolTipTemplateSelector>
    <conv:TypeNameConverter x:Key="TypeNameConverter"></conv:TypeNameConverter>
    <local:ObjectVisibilityConverter x:Key="ObjectVisibilityConverter"></local:ObjectVisibilityConverter>
    <controls:DoubleToNullConverter x:Key="DoubleToNullConverter" x:Shared="False"/>
    <controls:StringToNullConverter x:Key="StringToNullConverter" x:Shared="False"/>
    <!--<controls:BooleanToNullConverter x:Key="BooleanToNullConverter" x:Shared="False"/>-->
    <local:LabelConverter x:Key="LabelConverter" />
    <local:OneTimeConverter x:Key="OneTimeConverter" />
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" Collapse="False"></conv:BooleanToVisibilityConverter>
    <conv:InvertedBooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter" />
    <hex:MathConverter x:Key="MathConverter"></hex:MathConverter>

    <ObjectDataProvider
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        x:Key="MyEnumValues"
        MethodName="GetValues"
        ObjectType="{x:Type sys:Enum}">
        <ObjectDataProvider.MethodParameters>
            <x:Type xmlns:json="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json" TypeName="json:JTokenType" />
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>

    <ItemsControl x:Key="ItemsControlToolTip" ItemsSource="{Binding Source={StaticResource MyEnumValues}}">
        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type jlinq:JTokenType}">
                <Border
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Border.BorderBrush>
                    <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                        <Label.Background>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Label.Background>
                    </Label>
                </Border>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <WrapPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
    </ItemsControl>

    <Style x:Key="TokenToolTipStyle" TargetType="{x:Type ToolTip}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="HasDropShadow" Value="True"/>
        <Setter Property="DataContext" Value="{Binding Path=PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolTip">
                    <Border DataContext="{Binding Value.Type, Mode=OneWay}"
                    Margin="5"
                    BorderThickness="1"
                    CornerRadius="3,3,3,3">
                        <Border.BorderBrush>
                            <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                        </Border.BorderBrush>
                        <StackPanel>
                            <Label Content="{Binding Mode=OneWay}" Foreground="WhiteSmoke">
                                <Label.Background>
                                    <SolidColorBrush Color="{Binding Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                                </Label.Background>
                                <Label.Triggers>
                                    <EventTrigger RoutedEvent="Control.Loaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:2" Value="True" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="Control.Unloaded">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <BooleanAnimationUsingKeyFrames Storyboard.TargetName="PopupOnHover" Storyboard.TargetProperty="IsOpen">
                                                    <DiscreteBooleanKeyFrame KeyTime="0:0:0" Value="False" />
                                                </BooleanAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Label.Triggers>
                            </Label>
                            <Popup x:Name="PopupOnHover"
                                   Placement="Bottom"      
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide" Child="{StaticResource ItemsControlToolTip}">
                            </Popup>
                        </StackPanel>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <ToolTip x:Key="TokenToolTip" Style="{StaticResource TokenToolTipStyle}"/>

    <Style x:Key="JsonTreeViewItem" TargetType="{x:Type TreeViewItem}">
        <Setter Property="ToolTipService.InitialShowDelay" Value="2000"/>
        <Setter Property="ToolTip">
            <Setter.Value>
                <ContentControl Content="{Binding }" ContentTemplateSelector="{StaticResource ToolTipTemplateSelector}"></ContentControl>
            </Setter.Value>
        </Setter>
        <Setter Property="IsExpanded" Value="True" />
        <att:InteractivitySetter Property="{x:Static att:InteractivityItems.TemplateProperty}">
            <Setter.Value>
                <att:InteractivityTemplate>
                    <att:InteractivityItems>
                        <att:InteractivityItems.Behaviors>
                            <local:PreventCollapseBehavior></local:PreventCollapseBehavior>
                        </att:InteractivityItems.Behaviors>
                    </att:InteractivityItems>
                </att:InteractivityTemplate>
            </Setter.Value>
        </att:InteractivitySetter>
    </Style>

    <controls:JsonObjectTypeTemplateSelector x:Key="JsonObjectTypeTemplateSelector" />

    <local:JsonContainerStyleSelector x:Key="JsonContainerStyleSelector" >
        <local:JsonContainerStyleSelector.Resources>
            <res:SharedResourceDictionary Source="/Utility.WPF.Controls.Objects;component/Themes/Dictionary1.xaml" />
        </local:JsonContainerStyleSelector.Resources>
    </local:JsonContainerStyleSelector>

    <Style TargetType="{x:Type controls:JsonControl}" BasedOn="{StaticResource {x:Type TreeView}}">
        <Setter Property="IsTextSearchEnabled" Value="True" />
        <!--<Setter Property="ItemTemplateSelector" Value="{x:Static controls:TemplateSelector.JPropertyDataTemplateSelector}" />-->
        <Setter Property="ItemTemplateSelector" Value="{StaticResource JsonObjectTypeTemplateSelector}" />
        <!--<Setter Property="ItemContainerStyle" Value="{StaticResource JsonTreeViewItem}" />-->
        <Setter Property="ItemContainerStyleSelector" Value="{StaticResource JsonContainerStyleSelector}"/>
        <Setter Property="Background" Value="#FFF9F9F9"></Setter>
        <Style.Resources>

            <Style x:Key="LabelValue"  TargetType="ItemsControl">
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <Grid  Margin="0,2,0,2"   HorizontalAlignment="Left">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200"></ColumnDefinition>
                                    <ColumnDefinition Width="10"></ColumnDefinition>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                            </Grid>
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelStyle"  TargetType="TextBlock">
                <Setter Property="Opacity" Value="0.9"></Setter>
                <Setter Property="HorizontalAlignment" Value="Left"></Setter>
                <Setter Property="FontWeight" Value="DemiBold"></Setter>
                <Setter Property="ToolTip" Value="{StaticResource TokenToolTip}"></Setter>
                <Setter Property="ToolTipService.InitialShowDelay" Value="300"></Setter>
                <Setter Property="Text" Value="{Binding Path=Name, Mode=OneWay, Converter={StaticResource LabelConverter}}"></Setter>
                <Setter Property="Foreground">
                    <Setter.Value>
                        <SolidColorBrush Color="{Binding Path=Value.Type, Converter={x:Static controls:Converters.JTokenTypeToColorConverter}}" />
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="LabelValueContent" TargetType="ContentControl">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <ItemsControl Style="{StaticResource LabelValue}" >
                                <TextBlock Style="{StaticResource LabelStyle}" />
                                <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->
                                <ContentPresenter  Grid.Column="2">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseLeftButtonDown">
                                            <beh:InvokeCommandAction Command="{x:Static controls:Commands.FooCommand}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </ContentPresenter>
                            </ItemsControl>
                        </ControlTemplate>

                    </Setter.Value>
                </Setter>
            </Style>

            <!--<HierarchicalDataTemplate DataType="{x:Type jlinq:JConstructor}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Constructor" />
            </HierarchicalDataTemplate>
            <HierarchicalDataTemplate DataType="{x:Type jlinq:JRaw}" ItemsSource="{Binding ., Converter={x:Static controls:Converters.MethodToValueConverter}, ConverterParameter='Children'}">
                <TextBlock Text="Raw" />
            </HierarchicalDataTemplate>
            -->

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JArray}" x:Key="ArrayPropertyTemplate" ItemsSource="{Binding .}" >
                <Grid>
                    <Button Style="{StaticResource BasicButtonStyle}" Command="{Binding Source={x:Static local:Commands.FooCommand}}">
                        <Path  Stroke="Gray" StrokeThickness="2"   Stretch="UniformToFill" Data="{StaticResource Plus}"/>
                    </Button>
                </Grid>
            </HierarchicalDataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JProperty}" x:Key="Array2PropertyTemplate" ItemsSource="{Binding .}" />

            <conv:TypeNameConverter x:Key="TypeNameConverter"></conv:TypeNameConverter>


            <HierarchicalDataTemplate DataType="{x:Type jlinq:JObject}" x:Key="ObjectPropertyTemplate" ItemsSource="{Binding ., Converter={x:Static controls:ComplexPropertyMethodValueConverter.Instance}, ConverterParameter='Children'}">
                <WrapPanel>
                    <TextBlock Text="{Binding '[$type].Value', Converter={StaticResource TypeNameConverter}}" FontWeight="DemiBold" FontSize="14" Foreground="SeaGreen"></TextBlock>
                    <Button Style="{StaticResource BasicButtonStyle}" 
                                HorizontalAlignment="Right" 
                                Command="{Binding Source={x:Static local:Commands.UnFooCommand}}" 
                                Visibility="{Binding ., Converter={StaticResource ObjectVisibilityConverter}}">
                        <Path Stroke="Gray" StrokeThickness="2"  Stretch="UniformToFill" Data="{StaticResource Cross}"/>
                    </Button>
                </WrapPanel>
            </HierarchicalDataTemplate>

            <HierarchicalDataTemplate DataType="{x:Type jlinq:JProperty}" x:Key="PropertyTemplate" ItemsSource="{Binding ., Converter={x:Static controls:ComplexPropertyMethodValueConverter.Instance}, ConverterParameter='Children'}">
                <ContentControl Style="{StaticResource LabelValueContent}"/>
            </HierarchicalDataTemplate>

            <!--<VisibilityConverter x:Key="VisibilityConverter" />-->
            <controls:DoubleEventArgsConverter x:Key="DoubleEventArgsConverter" />
            <controls:GuidConverter x:Key="GuidConverter" />
            <!--<controls:IntegerConverter x:Key="IntegerConverter" />-->
            <controls:IndexConverter x:Key="IndexConverter" />
            <controls:TimeConverter x:Key="TimeConverter" />
            <controls:DateConverter x:Key="DateConverter" />
            <controls:DateTimeConverter x:Key="DateTimeConverter" />
            <controls:DecimalUpDownRangeConverter x:Key="DecimalUpDownRangeConverter" />
            <!--<controls:IntegerUpDownRangeConverter x:Key="IntegerUpDownRangeConverter" />-->
            <controls:EnumToNumberConverter x:Key="EnumToNumberConverter" />
            <controls:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
            <controls:NullableToVisibilityConverter x:Key="NullableToVisibilityConverter" />


            <controls:SchemaNullableToVisibilityConverter x:Key="SchemaNullableToVisibilityConverter" />
            <controls:SchemaNullableToBooleanConverter x:Key="SchemaNullableToBooleanConverter" />
            <controls:EventArgsConverter x:Key="EventArgsConverter" />
            <controls:BooleanEventArgsConverter x:Key="BooleanEventArgsConverter" />
            <controls:SelectionEventArgsConverter x:Key="SelectionEventArgsConverter" />

            <DataTemplate x:Key="TypeTemplate">
                <c:BreadCrumbs ItemsSource="{Binding Value.Value, Converter={x:Static conv:TypeHierarchyConverter.Instance}}"/>
            </DataTemplate>

            <DataTemplate x:Key="StringTemplate">
                <!--<TextBlock Text="{Binding Schema.Description}" Margin="0,0,0,4" Visibility="{Binding Schema.Description, Converter={StaticResource VisibilityConverter}}" />-->
                <Grid>

                    <Border BorderThickness="0,0,0,1"
                            Grid.Column="2"
                            Background="White"
                            BorderBrush="Black"
                            HorizontalAlignment="Stretch"
                            SnapsToDevicePixels="True">

                        <TextBox    
                            MinWidth="40"
                       
                            Visibility="{Binding IsChecked, ElementName=ToggleButton, Converter={StaticResource BooleanToVisibilityConverter}}"
                            x:Name="TextBox"
                            TextAlignment="Left"
                            HorizontalAlignment="Stretch"
                            Text="{Binding Value, Mode=TwoWay}"
                            TextWrapping="Wrap">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="LostFocus">
                                    <beh:InvokeCommandAction PassEventArgsToCommand="True" 
                                                             EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                             EventArgsConverterParameter="{Binding }" 
                                                             Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                                </i:EventTrigger>
                                
                            </i:Interaction.Triggers>
                            <i:Interaction.Behaviors>
                                <local:FocusBehavior >
                                    <local:FocusBehavior.Value>
                                        <MultiBinding Converter="{x:Static conv:IfConverter.Instance}">
                                            <Binding ElementName="ToggleButton" Path="IsFocused"></Binding>
                                            <Binding ElementName="ToggleButton" Path="IsChecked"></Binding>
                                        </MultiBinding>
                                    </local:FocusBehavior.Value>
                                </local:FocusBehavior>
                            </i:Interaction.Behaviors>
                             
                        </TextBox>

                    </Border>

                    <ToggleButton x:Name="ToggleButton" Height="{Binding ElementName=TextBox, Path=ActualHeight}" 
                                      Visibility="{Binding IsChecked, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource InvertedBooleanToVisibilityConverter}}" VerticalAlignment="Top">
                        <ToggleButton.Style>
                            <Style TargetType="{x:Type ToggleButton}">
                                <Style.Triggers>
                                    <Trigger Property="IsChecked" Value="False">
                                        <Setter Property="Content"  >
                                            <Setter.Value>
                                                <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource Null}"  Stretch="Uniform"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter Property="Content"  >
                                            <Setter.Value>
                                                <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource NotNull}" Stretch="Uniform"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ToggleButton.Style>
                        <ToggleButton.IsChecked>
                            <Binding Path="Value" Mode="TwoWay" >
                                <Binding.Converter>
                                    <StaticResource ResourceKey="StringToNullConverter"></StaticResource>
                                </Binding.Converter>
                            </Binding>
                        </ToggleButton.IsChecked>
                    </ToggleButton>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ReadOnlyTemplate">
                <TextBlock Text="{Binding Value, Mode=OneWay}" IsEnabled="False"></TextBlock>
            </DataTemplate>

            <DataTemplate x:Key="DateTimeTemplate">
                <xctk:DateTimePicker Format="ShortDate" Margin="0,0,0,8" 
                                     TextAlignment="Left" 
                                     AutoCloseCalendar="True"
                                     Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateTimeConverter}}" />
            </DataTemplate>

            <DataTemplate x:Key="DateTemplate">
                <xctk:DateTimePicker  Margin="0,0,0,8" TextAlignment="Left" Format="LongDate" 
                                         TimePickerVisibility="Collapsed" AutoCloseCalendar="True"
                                         Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateConverter}}" >
                    <i:Interaction.Triggers>
                        <i:PropertyChangedTrigger Binding="{Binding Path=Value, Mode=OneWayToSource}">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:PropertyChangedTrigger>
                    </i:Interaction.Triggers>
                </xctk:DateTimePicker>
            </DataTemplate>

            <DataTemplate x:Key="TimeTemplate">
                <xctk:TimePicker Margin="0,0,0,8" HorizontalAlignment="Stretch" 
                                     Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource TimeConverter}}" />
            </DataTemplate>

            <DataTemplate x:Key="NumberTemplate">
                <d:DoubleUpDown Margin="0,0,0,8" Value="{Binding Value, Mode=TwoWay}">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="ValueChanged">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource DoubleEventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </d:DoubleUpDown>
            </DataTemplate>

            <DataTemplate x:Key="NumberNullTemplate">
                <WrapPanel>

                    <Grid>

                        <FrameworkElement x:Name="One" >
                            <FrameworkElement.Style>
                                <Style TargetType="{x:Type FrameworkElement}">
                                    <Setter Property="MinHeight" Value="0">
                         
                                    </Setter>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=ToggleButton, Path=IsChecked}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="MinHeight"
                                         To="1" Duration="0:0:0.3" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                            <DataTrigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="MinHeight"
                                         To="0" Duration="0:0:0.3" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.ExitActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </FrameworkElement.Style>                         
                        </FrameworkElement>


                        <StackPanel>
                 
                            <d:DoubleUpDown x:Name="DoubleUpDown" Margin="0,0,0,0" Value="{Binding Value, Mode=TwoWay}"             >
                                <d:DoubleUpDown.Width>
                                    <MultiBinding Converter="{StaticResource OneTimeConverter}" ConverterParameter="x*y">
                                        <Binding ElementName="DoubleUpDown" Path="ActualWidth"></Binding>
                                        <Binding ElementName="One" Path="MinHeight"></Binding>
                                    </MultiBinding>
                                </d:DoubleUpDown.Width>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="ValueChanged">
                                        <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource DoubleEventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </d:DoubleUpDown>
                        </StackPanel>                      
                    </Grid>
                    <ToggleButton x:Name="ToggleButton" Height="{Binding ElementName=DoubleUpDown, Path=ActualHeight}" VerticalAlignment="Top">
                        <ToggleButton.Style>
                            <Style TargetType="{x:Type ToggleButton}">
                                <Style.Triggers>
                                    <Trigger Property="IsChecked" Value="False">
                                        <Setter Property="Content"  >
                                            <Setter.Value>
                                                <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource Null}"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter Property="Content"  >
                                            <Setter.Value>
                                                <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource NotNull}"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ToggleButton.Style>
                        <ToggleButton.IsChecked>
                            <Binding Path="Value" Mode="TwoWay" >
                                <Binding.Converter>
                                    <StaticResource ResourceKey="DoubleToNullConverter"></StaticResource>
                                </Binding.Converter>
                            </Binding>
                        </ToggleButton.IsChecked>

                    </ToggleButton>
                </WrapPanel>
            </DataTemplate>



            <DataTemplate x:Key="IntegerTemplate">
                <WrapPanel>
                    <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"  x:Name="IntegerUpDown"               
                                        Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <i:Interaction.Triggers>
                            <i:PropertyChangedTrigger Binding="{Binding ElementName=IntegerUpDown, Path=Value}">
                                <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                            </i:PropertyChangedTrigger>
                        </i:Interaction.Triggers>
                    </xctk:IntegerUpDown>
                </WrapPanel>
            </DataTemplate>
            <Style x:Key="textBoxInError" TargetType="TextBox">
                <Style.Triggers>
                    <Trigger Property="Validation.HasError" Value="true">
                        <Setter Property="ToolTip"
              Value="{Binding RelativeSource={x:Static RelativeSource.Self},
              Path=(Validation.Errors)[0].ErrorContent}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <DataTemplate x:Key="GuidTemplate">
                <TextBox Text="{Binding Value, Mode=TwoWay, ValidatesOnExceptions=True, Converter={StaticResource GuidConverter}}" Style="{StaticResource textBoxInError}">
                    <i:Interaction.Behaviors>
                        <beh:GuidEditBehavior />
                        <ad:HoverBehavior HorizontalAdornerPlacement="Outside" />
                        <ad:ContextBehavior AdornerPlacement="Outside"/>
                        <beh:GuidContextBehavior />
                    </i:Interaction.Behaviors>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="LostFocus">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource EventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </TextBox>
            </DataTemplate>
            <!--<DataTemplate x:Key="IntegerNullTemplate">
                <WrapPanel>
                    <xctk:IntegerUpDown Margin="0,0,0,8" TextAlignment="Left" HorizontalAlignment="Stretch"                                   
                                        Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Visibility="{Binding HasValue,Converter={StaticResource VisibilityConverter}}"/>
                    <ToggleButton Content="Null" >
                        <ToggleButton.IsChecked>
                            <MultiBinding>
                                <Binding Path="Value" Mode="TwoWay" />
                                <Binding Path="." Mode="OneTime" />
                                <MultiBinding.Converter>
                                    <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                </MultiBinding.Converter>
                            </MultiBinding>
                        </ToggleButton.IsChecked>
                    </ToggleButton>
                </WrapPanel>
            </DataTemplate>-->
            <DataTemplate x:Key="EnumTemplate">
                <ComboBox >
                    <ComboBox.DataContext>
                        <MultiBinding Converter="{StaticResource EnumConverter}">
                            <Binding Path="." Mode="OneWay"/>
                            <Binding Path="Name" Mode="OneWay"/>
                            <Binding Path="Value" Mode="OneWay"/>
                            <!--<Binding Path="Schema" Mode="OneWay" RelativeSource="{RelativeSource AncestorType=TreeView}"/>-->
                        </MultiBinding>
                    </ComboBox.DataContext>
                    <i:Interaction.Behaviors>
                        <beh:EnumComboBehavior  Value="{Binding Value, Mode=TwoWay}">
                        </beh:EnumComboBehavior>
                    </i:Interaction.Behaviors>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectionChanged">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" 
                                                       EventArgsConverter="{StaticResource SelectionEventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ComboBox>
            </DataTemplate>
            <DataTemplate x:Key="NullTemplate">
                <Path Stroke="Gray" StrokeThickness="2" Data="{StaticResource Null}"/>
            </DataTemplate>

            <DataTemplate x:Key="InvisibleTemplate">
            </DataTemplate>

            <DataTemplate x:Key="MissingTemplate">
                <Border BorderBrush="Red" BorderThickness="2">
                    <ContentControl Content="{Binding }"></ContentControl>
                </Border>
            </DataTemplate>

            <!--<DataTemplate x:Key="EnumNullTemplate">
                <UniformGrid Rows="1" >
                    <StackPanel >
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,0,4" />
                    </StackPanel>
                    <WrapPanel>
                        <ToggleButton Content="Null" >
                            <ToggleButton.IsChecked>
                                <MultiBinding>
                                    <Binding Path="Value" Mode="TwoWay" />
                                    <Binding Path="Schema.OneOf[1].ActualSchema" Mode="OneTime" />
                                    <MultiBinding.Converter>
                                        <StaticResource ResourceKey="BooleanToNullConverter"></StaticResource>
                                    </MultiBinding.Converter>
                                </MultiBinding>
                            </ToggleButton.IsChecked>
                        </ToggleButton>
                    </WrapPanel>
                </UniformGrid>
            </DataTemplate>-->
            <DataTemplate x:Key="BooleanTemplate">
                <!--<ContentControl Style="{StaticResource LabelValueContent}">-->
                <CheckBox IsChecked="{Binding Value, Mode=TwoWay, FallbackValue=false}" Margin="0,0,0,8" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="Checked">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource BooleanEventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="Unchecked">
                            <beh:InvokeCommandAction PassEventArgsToCommand="True" EventArgsConverter="{StaticResource BooleanEventArgsConverter}" 
                                                           EventArgsConverterParameter="{Binding }" 
                                                           Command="{Binding ChangeValueCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:JsonControl}}}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </CheckBox>
                <!--</ContentControl>-->
            </DataTemplate>
        </Style.Resources>
    </Style>

</ResourceDictionary>