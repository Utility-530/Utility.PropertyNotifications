<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:att="http://schemas.utility.com/attached"
                    xmlns:res="http://schemas.utility.com/resourcedictionary"
                    xmlns:local="clr-namespace:Utility.WPF.Controls.Trees"
                    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:b="http://schemas.utility.com/behaviors"
                    xmlns:conv="http://schemas.utility.com/converters">

    <ResourceDictionary.MergedDictionaries>
        <res:GeometryResourceDictionary/>
    </ResourceDictionary.MergedDictionaries>

    <SolidColorBrush x:Key="HighlightBrush" Color="DodgerBlue" />
    <SolidColorBrush x:Key="TagBackgroundColor" Color="#01FFFFFF" />
    <SolidColorBrush x:Key="TagForegroundColor" Color="Black" />

    <LinearGradientBrush x:Key="ItemAreaBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Color="Transparent" Offset="0" />
        <GradientStop Color="#22000000" Offset="1" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemAreaBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Color="Orange" Offset="0" />
        <GradientStop Color="LightCoral"  Offset="1" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemAreaBrush2" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Color="LightSalmon" Offset="0" />
        <GradientStop Color="DarkOrange"  Offset="1" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="ItemBorderBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Color="Transparent" Offset="0" />
        <GradientStop Color="LightGray" Offset="1" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemBorderBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Color="Yellow" Offset="0" />
        <GradientStop Color="Black" Offset="1" />
    </LinearGradientBrush>
    <DropShadowBitmapEffect x:Key="DropShadowEffect" />



    <Style x:Key="SelectedHorizontalStyle" TargetType="{x:Type local:CustomTreeViewItem}">
        <Setter Property="EditTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBox x:Name="PART_InputBox" MinWidth="100" VerticalAlignment="Center" 
                             Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,0"  
                             />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="HorizontalAlignment" Value="Stretch"></Setter>
        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"></Setter>
        <!--<Setter Property="Foreground" Value="{StaticResource ItemBorderBrush}"/>-->
        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
        <Setter Property="att:TreeEx.IsChildSelected" Value="false"></Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate  TargetType="{x:Type local:CustomTreeViewItem}">
                    <Grid Margin="{TemplateBinding Padding}" HorizontalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <!--The top row contains the item's content.-->
                            <RowDefinition Height="Auto" />
                            <!--The bottom row contains the item's children.-->
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- This Border and ContentPresenter displays the content of the TreeViewItem. -->
                        <Border Name="Bd" 
                                Background="{StaticResource ItemAreaBrush}"
                                BorderBrush="{TemplateBinding Foreground}"
                                HorizontalAlignment="Stretch"
                                BorderThickness="0.6" 
                                CornerRadius="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ContentPresenter Name="PART_Header"  
                                                  Margin="4"
                                                  ContentSource="Header"
                                                  HorizontalAlignment="Stretch"
                                                  VerticalAlignment="Center" />
                                <Button x:Name="PART_DeleteTagButton"
                                                Grid.Column="1"
                                                Command="{Binding RemoveCommand, RelativeSource={RelativeSource AncestorType={x:Type local:CustomTreeViewItem}, AncestorLevel=2} }"
                                        CommandParameter="{TemplateBinding Header}"
                                                Margin="0,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Visibility="Hidden">
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Grid Width="10"
                                                          Height="10"
                                                          Background="#01FFFFFF">
                                                <Path ClipToBounds="True"
                                                              Data="{StaticResource Cross}"
                                                              Stretch="Uniform"
                                                              Stroke="{StaticResource HighlightBrush}"
                                                              StrokeThickness="2" />
                                            </Grid>

                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </Border>
                        <WrapPanel x:Name="WrapPanel" Grid.Row="1"  Visibility="Collapsed" HorizontalAlignment="Stretch">
                            <ItemsPresenter x:Name="ItemsPresenter"/>
                            <Button 
                                x:Name="PART_CreateTagButton"
                                Margin="2,0,0,0"
                                VerticalAlignment="Center">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">

                                        <Grid Width="18"
                                                          Height="18"
                                                          Background="#01FFFFFF">
                                            <Path ClipToBounds="True"
                                                  x:Name="AddButton"
                                                  Data="{StaticResource Plus}"
                                                  Stretch="Uniform"
                                                  Visibility="Visible"
                                                  Stroke="{StaticResource HighlightBrush}"
                                                  StrokeThickness="2" />
                                        </Grid>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand" />
                                                <Setter Property="Foreground" Value="CadetBlue" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <!--<i:CallMethodAction MethodName="AcceptComboTreeViewItem_Click" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                        <!--<b:InvokeCommandAction Command="{Binding AddCommand, RelativeSource={RelativeSource Mode=TemplatedParent}}" IgnoreNulls="True"/>-->
                                        <b:SetterAction PropertyName="IsEditing" Value="True" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </Button>


                            <ContentPresenter
                                            x:Name="EditPresenter"  Visibility="Collapsed" VerticalAlignment="Center"
                                            ContentSource="Edit"/>

                        </WrapPanel>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver"  Value="True">
                            <Setter Property="Foreground" Value="{StaticResource HighlightBrush}" />
                            <Setter TargetName="PART_DeleteTagButton" Property="Visibility" Value="Visible" />
                        </Trigger>

                        <!--<EventTrigger SourceName="PART_CreateTagButton" RoutedEvent="IsClicked">
                            <
                        </EventTrigger>-->
                        <!--When the item is selected in the TreeView, use the 
                  "selected" colors and give it a drop shadow. -->
                        <Trigger Property="IsSelected" Value="True">
                            <Setter
                TargetName="Bd"
                Property="Panel.Background"                     
                Value="{StaticResource SelectedItemAreaBrush}" />
                            <Setter
                TargetName="Bd"
                Property="Border.BorderBrush"                     
                Value="{StaticResource SelectedItemBorderBrush}" />
                            <Setter
                TargetName="Bd"
                Property="TextElement.Foreground"                   
                Value="{DynamicResource 
                  {x:Static SystemColors.HighlightTextBrushKey}}" />
                            <!--<Setter
                TargetName="Bd"
                Property="Border.BitmapEffect"                  
                Value="{StaticResource DropShadowEffect}" />-->
                        </Trigger>
                        <Trigger Property="att:TreeEx.IsChildSelected" Value="True">
                            <Setter
                TargetName="Bd"
                Property="Panel.Background"                     
                Value="{StaticResource SelectedItemAreaBrush2}" />
                            <Setter
                TargetName="Bd"
                Property="Border.BorderBrush"                     
                Value="{StaticResource SelectedItemBorderBrush}" />
                            <Setter
                TargetName="Bd"
                Property="TextElement.Foreground"                   
                Value="{DynamicResource 
                  {x:Static SystemColors.HighlightTextBrushKey}}" />
                            <!--<Setter
                TargetName="Bd"
                Property="Border.BitmapEffect"                  
                Value="{StaticResource DropShadowEffect}" />-->
                        </Trigger>
                        <Trigger Property="IsExpanded" Value="True">
                            <Setter TargetName="WrapPanel" Property="Visibility" Value="Visible">

                            </Setter>
                        </Trigger>
                        <Trigger Property="IsEditing" Value="True">
                            <Setter Property="Visibility" TargetName="EditPresenter" Value="Visible"></Setter>
                            <Setter Property="Visibility" TargetName="PART_CreateTagButton" Value="Collapsed"></Setter>
                            <!--<Setter Property="Foreground" Value="Black"></Setter>-->
                            <!--<Setter TargetName="PART_CreateTagButton" Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>-->
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

        <!-- Make each TreeViewItem show it's children 
           in a horizontal StackPanel. -->
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel 
            HorizontalAlignment="Stretch" 
            IsItemsHost="True" 
        
            Orientation="Horizontal"  />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style x:Key="RootSelectedHorizontalStyle" BasedOn="{StaticResource SelectedHorizontalStyle}" TargetType="{x:Type local:CustomTreeViewItem}">
        <Setter Property="IsExpanded" Value="True"></Setter>
        <Setter Property="Footer" Value="{Binding Path=(att:TreeEx.SelectedItem), RelativeSource={RelativeSource Mode=Self}}"></Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate  TargetType="{x:Type local:CustomTreeViewItem}">
                    <Grid Margin="2"  HorizontalAlignment="Stretch"  >
                        <Grid.RowDefinitions>
                            <!--The top row contains the item's content.-->
                            <RowDefinition Height="Auto" />
                            <!--The bottom row contains the item's children.-->
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />

                        </Grid.RowDefinitions>
                        <Border Name="Bd" 
                                Grid.Row="0"
                            
                            HorizontalAlignment="Stretch"
                                BorderBrush="{TemplateBinding Foreground}"
                            BorderThickness="0.6" 
                                CornerRadius="8"
                                Padding="6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />

                                </Grid.ColumnDefinitions>

                                <ContentPresenter Name="PART_Header"                  
                ContentSource="Header"
                HorizontalAlignment="Center"
                VerticalAlignment="Center" />


                            </Grid>
                        </Border>

                        <WrapPanel x:Name="WrapPanel" Grid.Row="1"  Visibility="Visible">
                            <ItemsPresenter x:Name="ItemsPresenter"/>
                            <Button 
                                x:Name="PART_CreateTagButton"
                                Margin="2,0,0,0"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource HighlightBrush}"
                     >

                                <Button.Template>
                                    <ControlTemplate TargetType="Button">

                                        <Grid Width="18"
                                                          Height="18"
                                                          Background="#01FFFFFF">
                                            <Path ClipToBounds="True"
                                                  x:Name="AddButton"
                                                  Data="{StaticResource Plus}"
                                                  Stretch="Uniform"
                                                  Visibility="Visible"
                                                  Stroke="{TemplateBinding Foreground}"
                                                  StrokeThickness="2" />
                                        </Grid>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand" />
                                                <Setter Property="Foreground" Value="Black" />
                                            </Trigger>

                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <!--<i:CallMethodAction MethodName="AcceptComboTreeViewItem_Click" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                        <!--<b:InvokeCommandAction Command="{Binding AddCommand, RelativeSource={RelativeSource Mode=TemplatedParent}}" IgnoreNulls="True"/>-->
                                        <b:SetterAction PropertyName="IsEditing" Value="True" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </Button>

                            <ContentPresenter
                                            x:Name="EditPresenter"  Visibility="Collapsed" VerticalAlignment="Center"
                                            ContentSource="Edit"/>
                        </WrapPanel>
                        <Border Name="Bd2" 
                                Grid.Row="2"                         
                                BorderBrush="{TemplateBinding Foreground}"
                                BorderThickness="0.6" 
                                CornerRadius="8"                             
                                Padding="6">
                            <Grid>
                                <ContentPresenter Name="PART_Footer"                                         
                                                  ContentSource="Footer"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center" />
                            </Grid>
                        </Border>
                    </Grid>

                    <ControlTemplate.Triggers>

                        <Trigger Property="IsEditing" Value="True">
                            <Setter Property="Visibility" TargetName="EditPresenter" Value="Visible"></Setter>
                            <Setter Property="Visibility" TargetName="PART_CreateTagButton" Value="Collapsed"></Setter>
                            <Setter Property="Foreground" Value="Green"></Setter>

                        </Trigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

    </Style>
</ResourceDictionary>