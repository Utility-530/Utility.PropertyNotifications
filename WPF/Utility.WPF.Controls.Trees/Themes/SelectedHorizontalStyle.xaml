<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:att="http://schemas.utility.com/attached"
    xmlns:b="http://schemas.utility.com/behaviors"
    xmlns:res="http://schemas.utility.com/resourcedictionary"
    xmlns:local="clr-namespace:Utility.WPF.Controls.Trees">

    <ResourceDictionary.MergedDictionaries>
        <res:GeometryResourceDictionary />
    </ResourceDictionary.MergedDictionaries>

    <SolidColorBrush x:Key="HighlightBrush" Color="DodgerBlue" />
    <SolidColorBrush x:Key="TagBackgroundColor" Color="#01FFFFFF" />
    <SolidColorBrush x:Key="TagForegroundColor" Color="Black" />

    <LinearGradientBrush x:Key="ItemAreaBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Offset="0" Color="Transparent" />
        <GradientStop Offset="1" Color="#22000000" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemAreaBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Offset="0" Color="Orange" />
        <GradientStop Offset="1" Color="LightCoral" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemAreaBrush2" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Offset="0" Color="LightSalmon" />
        <GradientStop Offset="1" Color="DarkOrange" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="ItemBorderBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Offset="0" Color="Transparent" />
        <GradientStop Offset="1" Color="LightGray" />
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="SelectedItemBorderBrush" StartPoint="0.5, 0" EndPoint="0.5, 1">
        <GradientStop Offset="0" Color="Yellow" />
        <GradientStop Offset="1" Color="Black" />
    </LinearGradientBrush>
    <DropShadowBitmapEffect x:Key="DropShadowEffect" />

    <Style x:Key="SelectedHorizontalStyle" TargetType="{x:Type local:CustomTreeViewItem}">
        <Setter Property="EditTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBox
                        x:Name="PART_InputBox"
                        MinWidth="100"
                        Margin="0,0,0,0"
                        VerticalAlignment="Center"
                        Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
        <!--<Setter Property="Foreground" Value="{StaticResource ItemBorderBrush}" />-->
        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
        <Setter Property="att:TreeEx.IsChildSelected" Value="false" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:CustomTreeViewItem}">
                    <Grid Margin="{TemplateBinding Padding}" HorizontalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <!--  The top row contains the item's content.  -->
                            <RowDefinition Height="Auto" />
                            <!--  The bottom row contains the item's children.  -->
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!--  This Border and ContentPresenter displays the content of the TreeViewItem.  -->
                        <Border
                            Name="Bd"
                            HorizontalAlignment="Stretch"
                            Background="{StaticResource ItemAreaBrush}"
                            BorderBrush="{TemplateBinding Foreground}"
                            BorderThickness="0.6"
                            CornerRadius="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ContentPresenter
                                    Name="PART_Header"
                                    Margin="4"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Button
                                    x:Name="PART_DeleteTagButton"
                                    Grid.Column="1"
                                    Margin="0,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Command="{Binding RemoveCommand, RelativeSource={RelativeSource AncestorType={x:Type local:CustomTreeViewItem}, AncestorLevel=2}}"
                                    CommandParameter="{TemplateBinding Header}"
                                    Visibility="Hidden">
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Grid
                                                Width="10"
                                                Height="10"
                                                Background="#01FFFFFF">
                                                <Path
                                                    ClipToBounds="True"
                                                    Data="{StaticResource Cross}"
                                                    Stretch="Uniform"
                                                    Stroke="{StaticResource HighlightBrush}"
                                                    StrokeThickness="2" />
                                            </Grid>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </Border>
                        <WrapPanel
                            x:Name="WrapPanel"
                            Grid.Row="1"
                            HorizontalAlignment="Stretch"
                            Visibility="Collapsed">
                            <ItemsPresenter x:Name="ItemsPresenter" />
                            <Button
                                x:Name="PART_CreateTagButton"
                                Margin="2,0,0,0"
                                VerticalAlignment="Center">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">

                                        <Grid
                                            Width="18"
                                            Height="18"
                                            Background="#01FFFFFF">
                                            <Path
                                                x:Name="AddButton"
                                                ClipToBounds="True"
                                                Data="{StaticResource Plus}"
                                                Stretch="Uniform"
                                                Stroke="{StaticResource HighlightBrush}"
                                                StrokeThickness="2"
                                                Visibility="Visible" />
                                        </Grid>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand" />
                                                <Setter Property="Foreground" Value="CadetBlue" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <!--<i:CallMethodAction MethodName="AcceptComboTreeViewItem_Click" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                        <!--<b:InvokeCommandAction Command="{Binding AddCommand, RelativeSource={RelativeSource Mode=TemplatedParent}}" IgnoreNulls="True" />-->
                                        <b:SetterAction
                                            PropertyName="IsEditing"
                                            TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                            Value="True" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </Button>

                            <ContentPresenter
                                x:Name="EditPresenter"
                                VerticalAlignment="Center"
                                ContentSource="Edit"
                                Visibility="Collapsed" />
                        </WrapPanel>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Foreground" Value="{StaticResource HighlightBrush}" />
                            <Setter TargetName="PART_DeleteTagButton" Property="Visibility" Value="Visible" />
                        </Trigger>

                        <!--<EventTrigger SourceName="PART_CreateTagButton" RoutedEvent="IsClicked">
                            <
                        </EventTrigger>-->
                        <!--
                            When the item is selected in the TreeView, use the
                            "selected" colors and give it a drop shadow.
                        -->
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bd" Property="Panel.Background" Value="{StaticResource SelectedItemAreaBrush}" />
                            <Setter TargetName="Bd" Property="Border.BorderBrush" Value="{StaticResource SelectedItemBorderBrush}" />
                            <Setter TargetName="Bd" Property="TextElement.Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" />
                            <!--<Setter
                TargetName="Bd"
                Property="Border.BitmapEffect"
                Value="{StaticResource DropShadowEffect}" />-->
                        </Trigger>
                        <Trigger Property="att:TreeEx.IsChildSelected" Value="True">
                            <Setter TargetName="Bd" Property="Panel.Background" Value="{StaticResource SelectedItemAreaBrush2}" />
                            <Setter TargetName="Bd" Property="Border.BorderBrush" Value="{StaticResource SelectedItemBorderBrush}" />
                            <Setter TargetName="Bd" Property="TextElement.Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" />
                            <!--<Setter
                TargetName="Bd"
                Property="Border.BitmapEffect"
                Value="{StaticResource DropShadowEffect}" />-->
                        </Trigger>
                        <Trigger Property="IsExpanded" Value="True">
                            <Setter TargetName="WrapPanel" Property="Visibility" Value="Visible" />
                        </Trigger>
                        <Trigger Property="IsEditing" Value="True">
                            <Setter TargetName="EditPresenter" Property="Visibility" Value="Visible" />
                            <Setter TargetName="PART_CreateTagButton" Property="Visibility" Value="Collapsed" />
                            <!--<Setter Property="Foreground" Value="Black"></Setter>-->
                            <!--<Setter TargetName="PART_CreateTagButton" Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>-->
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

        <!--
            Make each TreeViewItem show it's children
            in a horizontal StackPanel.
        -->
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel
                        HorizontalAlignment="Stretch"
                        IsItemsHost="True"
                        Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style
        x:Key="RootSelectedHorizontalStyle"
        BasedOn="{StaticResource SelectedHorizontalStyle}"
        TargetType="{x:Type local:CustomTreeViewItem}">
        <Setter Property="IsExpanded" Value="True" />
        <Setter Property="Footer" Value="{Binding Path=(att:TreeEx.SelectedItem), RelativeSource={RelativeSource Mode=Self}}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:CustomTreeViewItem}">
                    <Grid Margin="2" HorizontalAlignment="Stretch">
                        <Grid.RowDefinitions>
                            <!--  The top row contains the item's content.  -->
                            <RowDefinition Height="Auto" />
                            <!--  The bottom row contains the item's children.  -->
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Border
                            Name="Bd"
                            Grid.Row="0"
                            Padding="6"
                            HorizontalAlignment="Stretch"
                            BorderBrush="{TemplateBinding Foreground}"
                            BorderThickness="0.6"
                            CornerRadius="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <ContentPresenter
                                    Name="PART_Header"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                            </Grid>
                        </Border>

                        <WrapPanel
                            x:Name="WrapPanel"
                            Grid.Row="1"
                            Visibility="Visible">
                            <ItemsPresenter x:Name="ItemsPresenter" />
                            <Button
                                x:Name="PART_CreateTagButton"
                                Margin="2,0,0,0"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource HighlightBrush}">

                                <Button.Template>
                                    <ControlTemplate TargetType="Button">

                                        <Grid
                                            Width="18"
                                            Height="18"
                                            Background="#01FFFFFF">
                                            <Path
                                                x:Name="AddButton"
                                                ClipToBounds="True"
                                                Data="{StaticResource Plus}"
                                                Stretch="Uniform"
                                                Stroke="{TemplateBinding Foreground}"
                                                StrokeThickness="2"
                                                Visibility="Visible" />
                                        </Grid>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Cursor" Value="Hand" />
                                                <Setter Property="Foreground" Value="Black" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <!--<i:CallMethodAction MethodName="AcceptComboTreeViewItem_Click" TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}" />-->
                                        <!--<b:InvokeCommandAction Command="{Binding AddCommand, RelativeSource={RelativeSource Mode=TemplatedParent}}" IgnoreNulls="True" />-->
                                        <b:SetterAction
                                            PropertyName="IsEditing"
                                            TargetObject="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                            Value="True" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </Button>

                            <ContentPresenter
                                x:Name="EditPresenter"
                                VerticalAlignment="Center"
                                ContentSource="Edit"
                                Visibility="Collapsed" />
                        </WrapPanel>
                        <Border
                            Name="Bd2"
                            Grid.Row="2"
                            Padding="6"
                            BorderBrush="{TemplateBinding Foreground}"
                            BorderThickness="0.6"
                            CornerRadius="8">
                            <Grid>
                                <ContentPresenter
                                    Name="PART_Footer"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    ContentSource="Footer" />
                            </Grid>
                        </Border>
                    </Grid>

                    <ControlTemplate.Triggers>

                        <Trigger Property="IsEditing" Value="True">
                            <Setter TargetName="EditPresenter" Property="Visibility" Value="Visible" />
                            <Setter TargetName="PART_CreateTagButton" Property="Visibility" Value="Collapsed" />
                            <Setter Property="Foreground" Value="Green" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>