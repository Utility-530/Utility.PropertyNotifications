<Grid x:Class="Utility.WPF.Controls.Html.HtmlView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:local="clr-namespace:Utility.WPF.Controls.Html"
             xmlns:att="http://schemas.utility.com/attached"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             xmlns:sys="clr-namespace:System.Windows.Controls" 
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
             mc:Ignorable="d">

    <FrameworkElement.Resources>
        <ResourceDictionary>
            <local:BoolToWidthConverter x:Key="BoolToWidthConverter" />
            <Style x:Key="GridSplitterPreviewStyle">
                <Setter Property="Control.Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <Rectangle Fill="#80000000" />
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="{x:Type sys:CustomGridSplitter}" TargetType="{x:Type sys:CustomGridSplitter}">
                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type sys:CustomGridSplitter}">
                            <Border BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}" />
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Utility.WPF.Geometries;component/Resources.xaml"></ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </FrameworkElement.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="*" MinHeight="80" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="150" MinHeight="50" />
        </Grid.RowDefinitions>
        <Grid x:Name="_grid2" Grid.Row="0">
            <ItemsControl>
            <wv2:WebView2 x:Name="_htmlPanel"></wv2:WebView2>
            <sys:CustomGridSplitter x:Name="_splitter" Grid.Column="1" Width="4" VerticalAlignment="Stretch"  HorizontalAlignment="Center" Background="#BFDBFF" />
                <WebBrowser x:Name="_webBrowser" Grid.Column="2" />
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="{Binding Path=(att:Ex.IsChecked), Converter={StaticResource BoolToWidthConverter}, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                                <ColumnDefinition Width="{Binding Path=(att:Ex.IsChecked), Converter={StaticResource BoolToWidthConverter}, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.Style>
                    <Style TargetType="{x:Type ItemsControl}">
                        <Setter Property="att:Ex.IsChecked" Value="False" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ItemsControl}">
                                    <DockPanel>
                                        <ToggleButton x:Name="hider" DockPanel.Dock="Top"  VerticalAlignment="Top" HorizontalAlignment="Right" Width="16" Background="Transparent" BorderThickness="0"></ToggleButton>

                                        <Border x:Name="presenter">
                                            <ItemsPresenter />
                                        </Border>
                                    </DockPanel>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="True">
                                            <Setter Property="att:Ex.IsChecked" Value="False" />
                                            <Setter TargetName="hider" Property="Content">
                                                <Setter.Value>
                                                    <Path Data="{StaticResource LeftArrow}" StrokeEndLineCap="Round"  Stretch="Uniform" Stroke="Black" StrokeThickness="2"></Path>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                                            <Setter Property="att:Ex.IsChecked" Value="True" />
                                            <Setter TargetName="hider" Property="Content">
                                                <Setter.Value>
                                                    <Path Data="{StaticResource RightArrow}" StrokeEndLineCap="Round" Stretch="Uniform" Stroke="Black" StrokeThickness="2"></Path>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <!--<Style.Triggers>
                            <Trigger Property="Content" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </Trigger>
                        </Style.Triggers>-->
                    </Style>
                </ItemsControl.Style>
            </ItemsControl>
        </Grid>

        <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" Height="4" Background="#BFDBFF" />

        <Grid Grid.Row="2">
            <!--<xctk:RichTextBox x:Name="_htmlEditor" VerticalScrollBarVisibility="Visible" BorderThickness="0"
                         TextChanged="OnHtmlEditor_TextChanged" />-->

            <avalonedit:TextEditor x:Name="_htmlEditor"
                  VerticalScrollBarVisibility="Visible" BorderThickness="0"
                       TextChanged="OnHtmlEditor_TextChanged"
                    SyntaxHighlighting="HTML"
                    ShowLineNumbers="True" />

            <Label HorizontalAlignment="Right" Margin="0,0,16,14" VerticalAlignment="Bottom" Grid.Row="2" FontSize="11" Foreground="Blue" Cursor="Hand"
               MouseLeftButtonUp="OnRefreshLink_MouseLeftButtonUp">
                <Underline>Refresh</Underline>
            </Label>
            <CheckBox x:Name="_coloredCheckBox" HorizontalAlignment="Right" Margin="0,0,22,2" VerticalAlignment="Bottom" FontSize="11" Foreground="Blue" Cursor="Hand"
               Click="OnColoredCheckbox_click">
                <Underline>Colored</Underline>
            </CheckBox>
        </Grid>
    </Grid>