<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Utility.WPF.Controls"
                    xmlns:mvvm="http://hexinnovation.com/math"
                    xmlns:conv="http://schemas.utility.com/converters"
                    xmlns:sys="clr-namespace:System;assembly=netstandard"
                    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:geo="http://schemas.utility.com/geometries"
                    xmlns:res="http://schemas.utility.com/resourcedictionary">

    <ResourceDictionary.MergedDictionaries>
        <res:GeometryResourceDictionary />
    </ResourceDictionary.MergedDictionaries>

    <local:LastItemConverter x:Key="LastItemConverter" />
    <!--<local:MathConverter x:Key="MathConverter"></local:MathConverter>-->
    <mvvm:MathConverter x:Key="MathConverter"></mvvm:MathConverter>

    <Storyboard x:Key="Storyboard3">
        <!-- Animate the Background color to change -->
        <BooleanAnimationUsingKeyFrames Storyboard.TargetProperty="IsExpanded" Duration="0:0:4">
            <DiscreteBooleanKeyFrame Value="False" KeyTime="0:0:0" />
            <DiscreteBooleanKeyFrame Value="True" KeyTime="0:0:1" />
        </BooleanAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Storyboard1">
        <DoubleAnimation Storyboard.TargetName="Var_Animation_0to1" Storyboard.TargetProperty="(FrameworkElement.Width)" From="0.33" To="1" Duration="0:0:1">
        </DoubleAnimation>
    </Storyboard>

    <Storyboard x:Key="Storyboard5">
        <!-- Animate the Background color to change -->
        <BooleanAnimationUsingKeyFrames Storyboard.TargetProperty="IsExpanded" Duration="0:0:4">
            <DiscreteBooleanKeyFrame Value="True" KeyTime="0:0:0" />
        </BooleanAnimationUsingKeyFrames>
        <BooleanAnimationUsingKeyFrames Storyboard.TargetName="Toggle" Storyboard.TargetProperty="IsChecked">
            <DiscreteBooleanKeyFrame Value="False" KeyTime="0:0:4" />
        </BooleanAnimationUsingKeyFrames>
    </Storyboard>

    <Style  TargetType="{x:Type local:BreadCrumbs}">
        <Style.Resources>
        </Style.Resources>

        <Setter Property="SnapsToDevicePixels"
                Value="true" />
        <Setter Property="Focusable"
                Value="False" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel FlowDirection="LeftToRight" Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <ControlTemplate.Resources>
                    </ControlTemplate.Resources>
                    <Grid>

                        <Border x:Name="Var_Animation_0to1" Width="0.33" />

                        <ScrollViewer HorizontalScrollBarVisibility="Hidden"  VerticalScrollBarVisibility="Disabled" Background="Transparent" FlowDirection="RightToLeft" HorizontalAlignment="{TemplateBinding HorizontalAlignment}">
                            <FrameworkElement.Width>
                                <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="xy">
                                    <Binding ElementName="Var_Animation_0to1" Path="Width" />
                                    <Binding ElementName="BackBorder" Path="ActualWidth" />
                                </MultiBinding>
                            </FrameworkElement.Width>
                            <i:Interaction.Behaviors>
                                <local:ScrollToBottomBehavior />
                            </i:Interaction.Behaviors>

                            <ItemsPresenter x:Name="BackBorder" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                        </ScrollViewer>

                        <ToggleButton HorizontalAlignment="Left" x:Name="Toggle">
                            <ToggleButton.Template>
                                <ControlTemplate TargetType="ToggleButton">
                                    <Border>

                                        <Grid Background="{TemplateBinding Background}">
                                            <Path

                                        x:Name="Arrow"
                                        Fill="{TemplateBinding Foreground}"
                                        Margin="3,0,4,-4"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Data="{StaticResource RightChevronGeometry2}" />
                                        </Grid>
                                    </Border>
                                </ControlTemplate>
                            </ToggleButton.Template>

                            <ToggleButton.Style>

                                <Style TargetType="ToggleButton">

                                    <Setter Property="Background" Value="White"></Setter>
                                    <Setter Property="Foreground" Value="Orange"></Setter>
                                    <Setter Property="BorderBrush" Value="Transparent"></Setter>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <ColorAnimation Storyboard.TargetProperty="(Button.Background).(SolidColorBrush.Color)"
                                                        To="LightGreen"
                                                        Duration="0:0:0.3" />
                                                        <ColorAnimation Storyboard.TargetProperty="(Button.Foreground).(SolidColorBrush.Color)"
                                                        To="Black"
                                                        Duration="0:0:0.3" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                            <DataTrigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <ColorAnimation Storyboard.TargetProperty="(Button.Background).(SolidColorBrush.Color)"
                                                        To="White"
                                                        Duration="0:0:0.3" />
                                                        <ColorAnimation Storyboard.TargetProperty="(Button.Foreground).(SolidColorBrush.Color)"
                                                        To="Orange"
                                                        Duration="0:0:0.3" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.ExitActions>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding IsChecked, RelativeSource={RelativeSource Self}}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <ColorAnimation  Storyboard.TargetProperty="(Button.Foreground).(SolidColorBrush.Color)"
                                                        To="Black"
                                                        Duration="0:0:0" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                            <DataTrigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <ColorAnimation  Storyboard.TargetProperty="(Button.Foreground).(SolidColorBrush.Color)"
                                                        To="Orange"
                                                        Duration="0:0:0" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.ExitActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <Binding Path="IsExpanded" RelativeSource="{RelativeSource Mode=Self}" />
                            </DataTrigger.Binding>
                            <!--<Setter TargetName="Arrow" Property="Fill" Value="Red" />-->
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Name="sb" Storyboard="{StaticResource Storyboard1}">
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <StopStoryboard BeginStoryboardName="sb" />
                            </DataTrigger.ExitActions>
                        </DataTrigger>

                        <!--MouseOver trigger to change background-->
                        <DataTrigger Binding="{Binding IsChecked,ElementName=Toggle}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Name="sb2" Storyboard="{StaticResource Storyboard5}" />
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <StopStoryboard BeginStoryboardName="sb2" />
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style>
                    <Setter Property="Control.Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">

                                <StackPanel Orientation="Horizontal" Background="Transparent" x:Name="grid" TextBlock.FontSize="10">

                                    <!-- animated Border.Width    From 0 to (TotalWidth-SliderWidth) -->

                                    <Path

                                        x:Name="Arrow"
                                        Fill="Black"
                                        Margin="4,0,4,-4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="{StaticResource RightChevronGeometry2}" />
                                    <ContentPresenter Width="{Binding Path=ContainerWidth, RelativeSource={RelativeSource AncestorType={x:Type local:BreadCrumbs}}}" VerticalAlignment="Center" />
                                </StackPanel>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="BreadCrumbsAlernate2Style" TargetType="{x:Type local:BreadCrumbs}">
        <Style.Resources>
        </Style.Resources>

        <Setter Property="SnapsToDevicePixels"
                Value="true" />
        <Setter Property="Focusable"
                Value="False" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel FlowDirection="LeftToRight" Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <ControlTemplate.Resources>
                    </ControlTemplate.Resources>
                    <Grid>

                        <Border x:Name="Var_Animation_0to1" Width="0.33" />
                        <ScrollViewer HorizontalScrollBarVisibility="Hidden"  VerticalScrollBarVisibility="Disabled" Background="Transparent" FlowDirection="RightToLeft" HorizontalAlignment="{TemplateBinding HorizontalAlignment}">
                            <FrameworkElement.Width>
                                <MultiBinding Converter="{StaticResource MathConverter}" ConverterParameter="xy">
                                    <Binding ElementName="Var_Animation_0to1" Path="Width" />
                                    <Binding ElementName="BackBorder" Path="ActualWidth" />
                                </MultiBinding>
                            </FrameworkElement.Width>
                            <i:Interaction.Behaviors>
                                <local:ScrollToBottomBehavior />
                            </i:Interaction.Behaviors>

                            <ItemsPresenter x:Name="BackBorder" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                        </ScrollViewer>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <Binding Path="IsExpanded" RelativeSource="{RelativeSource Mode=Self}" />
                            </DataTrigger.Binding>
                            <!--<Setter TargetName="Arrow" Property="Fill" Value="Red" />-->
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Name="sb" Storyboard="{StaticResource Storyboard1}">
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <StopStoryboard BeginStoryboardName="sb" />
                            </DataTrigger.ExitActions>
                        </DataTrigger>

                        <!-- MouseOver trigger to change background -->
                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard Name="sb2" Storyboard="{StaticResource Storyboard3}" />
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <StopStoryboard BeginStoryboardName="sb2" />
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style>
                    <Setter Property="Control.Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">

                                <StackPanel Orientation="Horizontal" Background="Transparent" x:Name="grid" TextBlock.FontSize="10">

                                    <!-- animated Border.Width    From 0 to (TotalWidth-SliderWidth) -->

                                    <Path

                                        x:Name="Arrow"
                                        Fill="Black"
                                        Margin="4,0,4,-4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="{StaticResource RightChevronGeometry2}" />
                                    <ContentPresenter Width="80" VerticalAlignment="Center" />
                                </StackPanel>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>

    <Storyboard x:Key="Storyboard4">
        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="grid" Storyboard.TargetProperty="(FrameworkElement.Width)">
            <EasingDoubleKeyFrame KeyTime="00:00:0" Value="100" />
            <EasingDoubleKeyFrame KeyTime="00:00:01" Value="0" />
        </DoubleAnimationUsingKeyFrames>
        <!--<ColorAnimationUsingKeyFrames Storyboard.TargetName="grid" Storyboard.TargetProperty="(Control.Background).(SolidColorBrush.Color)">
            <EasingColorKeyFrame KeyTime="00:00:01" Value="#FFBB2F2F" />
        </ColorAnimationUsingKeyFrames>-->
    </Storyboard>

    <Style x:Key="BreadCrumbsAlernateStyle" TargetType="{x:Type local:BreadCrumbs}">
        <Setter Property="SnapsToDevicePixels"
                Value="true" />
        <Setter Property="Focusable"
                Value="False" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"></WrapPanel>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <ToggleButton Background="Transparent" BorderBrush="Transparent" IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource Mode=TemplatedParent}}">

                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Background="Transparent">

                            <ItemsPresenter SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                        </ScrollViewer>
                    </ToggleButton>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style>
                    <Setter Property="Control.Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ContentControl">

                                <StackPanel Orientation="Horizontal" Background="Transparent" x:Name="grid" ToolTip="{TemplateBinding Content}">
                                    <Path

                                        x:Name="Arrow"
                                        Fill="Black"
                                        Margin="4,0,4,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Data="{StaticResource RightChevronGeometry2}" />
                                    <ContentPresenter />
                                </StackPanel>

                                <ControlTemplate.Triggers>
                                    <DataTrigger Value="True">
                                        <DataTrigger.Binding>
                                            <MultiBinding Converter="{StaticResource LastItemConverter}">
                                                <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ItemsControl}}" />
                                                <Binding RelativeSource="{RelativeSource Self}" />
                                                <Binding Path="IsExpanded" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ItemsControl}}" />
                                                <!--<Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ItemsControl}}" Path="Items.Count" />-->
                                            </MultiBinding>
                                        </DataTrigger.Binding>
                                        <!--<Setter TargetName="Arrow" Property="Fill" Value="Red" />-->
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard Name="sb" Storyboard="{StaticResource Storyboard4}">
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                        <DataTrigger.ExitActions>
                                            <StopStoryboard BeginStoryboardName="sb" />
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>