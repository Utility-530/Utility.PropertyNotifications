<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
                    xmlns:t="http://schemas.utility.com/trees"
                    xmlns:local="clr-namespace:Utility.Nodes.Demo.Lists"
                    xmlns:conv="http://schemas.utility.com/converters"
                    xmlns:bc="http://schemas.utility.com/Breadcrumbs" 
                    xmlns:att="http://schemas.utility.com/attached" 
                    xmlns:beh="http://schemas.utility.com/behaviors" 
                    xmlns:panels="http://schemas.utility.com/panels"
                    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:c="http://schemas.utility.com/colours" 
                    xmlns:res="http://schemas.utility.com/resourcedictionary" 
                    xmlns:markup="http://schemas.utility.com/markup"
                    xmlns:nodes="clr-namespace:Utility.Nodes;assembly=Utility.Nodes">

    <ResourceDictionary.MergedDictionaries>
        <res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Shared.xaml"/>
    </ResourceDictionary.MergedDictionaries>
    
    <Style x:Key="DefaultChildCustomStyle" TargetType="{x:Type t:CustomTreeViewItem}" BasedOn="{StaticResource {x:Type t:CustomTreeViewItem}}">
        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"></Setter>
        <Setter Property="SelectionItem" Value="{Binding Current, Mode=TwoWay}"/>
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <!--<Setter Property="Background" Value="{c:Amber}"></Setter>-->
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type t:CustomTreeViewItem}">
                    <Grid  HorizontalAlignment="Stretch" >
                        <ToggleButton x:Name="Toggle" Style="{StaticResource CustomToggleStyle}" HorizontalAlignment="Stretch" Height="100" Margin="12"                                     
                                      IsChecked="{Binding IsSelected, Mode=OneWayToSource,RelativeSource={RelativeSource Mode=TemplatedParent}}">
                            <i:Interaction.Triggers >
                                <i:DataTrigger Value="True" Binding="{Binding ElementName=Toggle, Path=IsChecked}">
                                    <i:ChangePropertyAction PropertyName="IsChecked" Value="false" />
                                </i:DataTrigger>
                            </i:Interaction.Triggers>
                            <ContentPresenter Content="{TemplateBinding Header}"></ContentPresenter>
                        </ToggleButton>
                        <!--<Ellipse x:Name="Ellipse" Fill="{TemplateBinding Background}" Height="20" Width="20"></Ellipse>-->
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger SourceName="Toggle" Property="IsChecked" Value="True">
                            <Setter TargetName="Toggle" Property="Background" Value="Chocolate" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style x:Key="DefaultCustomStyle" TargetType="{x:Type t:CustomTreeViewItem}">
        <Setter Property="SelectedIndex" Value="-1"/>
        <Setter Property="SelectionItem" Value="{Binding Current, Mode=TwoWay}"/>
        <att:InteractivitySetter Property="att:InteractivityItems.Template">
            <Setter.Value>
                <att:InteractivityTemplate>
                    <att:InteractivityItems>
                        <att:InteractivityItems.Triggers>
                            <!--<i:EventTrigger EventName="Loaded">
                                <beh:SetterAction TargetObject="{Binding }" PropertyName="Current" Value="{x:Null}"></beh:SetterAction>
                                <beh:SetterAction PropertyName="SelectedIndex" Value="-1"></beh:SetterAction>
                            </i:EventTrigger>-->
                            <!--<i:EventTrigger EventName="SelectionChanged">
                                <beh:SetterAction TargetObject="{Binding }" PropertyName="Current" Value="{x:Null}"/>
                                <beh:SetterAction PropertyName="SelectedIndex" Value="-1"/>
                            </i:EventTrigger>-->
                        </att:InteractivityItems.Triggers>
                    </att:InteractivityItems>
                </att:InteractivityTemplate>
            </Setter.Value>
        </att:InteractivitySetter>
    </Style>

    <local:ComboContainerStyleSelector x:Key="ComboContainerStyleSelector"
                                       ComboStyle="{StaticResource DefaultChildCustomStyle}"
                                    DefaultStyle="{StaticResource DefaultCustomStyle}">
    </local:ComboContainerStyleSelector>


    <DataTemplate x:Key="MasterTemplate" DataType="{x:Type nodes:NodeViewModel}">


            <t:CustomTreeView   
                Grid.Row="1"
                ItemsSource="{markup:Array {Binding}}" ItemContainerStyleSelector="{StaticResource ComboContainerStyleSelector}" 
               >


                <t:CustomTreeView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel></StackPanel>
                        <!--<panels:AnimatedWrapPanel/>-->
                    </ItemsPanelTemplate>
                </t:CustomTreeView.ItemsPanel>
            </t:CustomTreeView>
        <!--</Grid>-->
    </DataTemplate>

</ResourceDictionary>