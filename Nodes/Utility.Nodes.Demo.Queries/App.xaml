<Application x:Class="Utility.Nodes.Demo.Queries.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:Utility.Nodes.Demo.Queries" 
             xmlns:obj="http://schemas.utility.com/objects"
             xmlns:lsts="http://schemas.utility.com/lists" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:ct="http://schemas.utility.com/trees" 
             xmlns:conv="http://schemas.utility.com/converters"
             xmlns:res="http://schemas.utility.com/resourcedictionary" 
             xmlns:bc="http://schemas.utility.com/Breadcrumbs"
             x:Name="myApplication">

    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Utility.WPF.Controls.Lists;component/CustomSelector.xaml"></ResourceDictionary>
                <ResourceDictionary Source="/Dictionary1.xaml"></ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
            <ObjectDataProvider x:Key="SchemaFromFile"
                ObjectType="{x:Type local:SchemaLoader}"
                MethodName="LoadSchema" >
            </ObjectDataProvider>

            <CollectionViewSource x:Key="ListBoxItems" Source="{Binding Path=Filters}">
                <CollectionViewSource.GroupDescriptions>
                    <PropertyGroupDescription PropertyName="GroupKey" />
                </CollectionViewSource.GroupDescriptions>
            </CollectionViewSource>


            <HierarchicalDataTemplate DataType="{x:Type local:User}" ItemsSource="{Binding Cars}">
                <obj:JsonControl Object="{Binding Converter={StaticResource ObjectToTokenConverter}}"></obj:JsonControl>
            </HierarchicalDataTemplate>

            <DataTemplate x:Key="One">
                <Ellipse Fill="Red" Height="40" Width="40"></Ellipse>
            </DataTemplate>

            <ControlTemplate x:Key="TemplateOne" TargetType="{x:Type TreeViewItem}">
                <Grid>
                    <ContentPresenter x:Name="PART_Header" ContentSource="Header"/>
                    <Rectangle Fill="Blue" Height="40" Width="40"></Rectangle>

                </Grid>
            </ControlTemplate>

            <DataTemplate DataType="{x:Type local:Car}">
                <obj:JsonControl Object="{Binding Converter={StaticResource ObjectToTokenConverter}}"></obj:JsonControl>
            </DataTemplate>

            <DataTemplate  DataType="{x:Type local:MainViewModel}">
                <DockPanel>
                    <WrapPanel DockPanel.Dock="Top" HorizontalAlignment="Left">
                        <Button Command="{Binding RefreshCommand}" Width="200" Height="30" Margin="2">refresh</Button>
                        <Button Command="{Binding SaveCommand}" Width="200" Height="30" Margin="2">save</Button>
                    </WrapPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <TreeView x:Name="MyTreeView" 
                                  ItemsSource="{Binding Users}"        
                                  ItemTemplateSelector="{x:Static local:CustomDataTemplateSelector.Instance}"
                                  ItemContainerStyleSelector="{x:Static local:CustomStyleSelector.Instance}" >
                            <i:Interaction.Behaviors>
                                <local:HighlightItems x:Name="a" Items="{Binding Filtered}"/>
                            </i:Interaction.Behaviors>
                        </TreeView>
                        <!--<TreeView x:Name="MyTreeView"            
                        AlternationCount="{Binding RelativeSource={RelativeSource Self}, Path=Items.Count}" >

                        <TreeViewItem Header="Item2" >
                            <TreeViewItem Header="SubItem1"/>
                            <TreeViewItem Header="SubItem2" />
                        </TreeViewItem>
                        <TreeViewItem Header="Item3" >
                            <TreeViewItem Header="SubItem3" />
                            <TreeViewItem Header="SubItem4" />
                            <TreeViewItem Header="SubItem5" />
                            <TreeViewItem Header="SubItem6" />
                            <TreeViewItem Header="SubItem7" />
                            <TreeViewItem Header="SubItem8" >
                                <TreeViewItem Header="SubSubItem1" />
                                <TreeViewItem Header="SubSubItem2" />
                                <TreeViewItem Header="SubSubItem3" />
                                <TreeViewItem Header="SubSubItem4" />
                            </TreeViewItem>
                        </TreeViewItem>
                    </TreeView>-->

                        <!--<DataGrid x:Name="DataGrid" ItemsSource="{Binding Users}"/>-->

                        <GridSplitter Grid.Column="1" Width="5" VerticalAlignment="Stretch" HorizontalAlignment="Center"/>

                        <DockPanel Grid.Column="2">
                            <lsts:CustomSelector x:Name="ListBox" ItemsSource="{Binding Filters}"
                                                 SelectedItem="{Binding Filter, Mode=TwoWay}" 
                                                 CheckedCommand="{Binding CheckedCommand}" 
                                                 ItemsWidth="560"
                                                 ItemsHeight="100" >
                                <ListBox.GroupStyle>
                                    <GroupStyle>
                                        <GroupStyle.Panel>
                                            <ItemsPanelTemplate>
                                                <VirtualizingStackPanel Orientation="Vertical" />
                                            </ItemsPanelTemplate>
                                        </GroupStyle.Panel>
                                        <GroupStyle.ContainerStyle>
                                            <Style TargetType="{x:Type GroupItem}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate>
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="*"/>
                                                                    <RowDefinition Height="*"/>
                                                                </Grid.RowDefinitions>
                                                                <TextBlock FontSize="24" Padding="0" Text="{Binding Name}" HorizontalAlignment="Center"/>
                                                                <ItemsPresenter Grid.Row="1"/>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </GroupStyle.ContainerStyle>
                                    </GroupStyle>
                                </ListBox.GroupStyle>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource ListBoxItemStyle1}"/>
                                </ItemsControl.ItemContainerStyle>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="FinishEdit">
                                        <i:InvokeCommandAction Command="{Binding FinishEdit}"  PassEventArgsToCommand="True"></i:InvokeCommandAction>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </lsts:CustomSelector>
                        </DockPanel>

                        <GridSplitter Grid.Column="3" Width="5" VerticalAlignment="Stretch" HorizontalAlignment="Center"/>

                        <Grid Grid.Column="4" >
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"></RowDefinition>
                                <RowDefinition Height="*"></RowDefinition>
                            </Grid.RowDefinitions>


                            <TextBlock Text="{Binding Filter.Key}"></TextBlock>

                            <ct:CustomTreeView ItemsSource="{Binding Nodes}" Grid.Row="1">
                                <TreeView.Resources>
                                    <ResourceDictionary>
                                        <ResourceDictionary.MergedDictionaries>
                                            <res:SharedResourceDictionary Source="/Utility.WPF.Controls.ComboBoxes;component/Themes/CustomComboTreeViewItemStyle.xaml"/>
                                            <res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Generic.xaml"/>
                                            <res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Templates.xaml"/>
                                            <ResourceDictionary Source="/Utility.WPF.Controls.Trees;component/Themes/CustomTreeViewItem.xaml"/>
                                            <ResourceDictionary Source="/Utility.WPF.Controls.Breadcrumbs;component/Themes/Generic.xaml"/>
                                        </ResourceDictionary.MergedDictionaries>
                                        <Style x:Key="MyDefaultContentStyle" TargetType="{x:Type ct:CustomTreeViewItem}">
                                            <Setter Property="NodeTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <ContentControl Content="{Binding Converter={StaticResource TypeNameConverter}}"></ContentControl>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="ToolTip" Value="{Binding Key}"></Setter>
                                            <Setter Property="Background" Value="White"></Setter>
                                            <Setter Property="Orientation" Value="Horizontal"></Setter>
                                            <Setter Property="BorderThickness" Value="2"></Setter>
                                            <Setter Property="ItemsPanel">
                                                <Setter.Value>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel/>
                                                    </ItemsPanelTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="NodeItemsSource">
                                                <Setter.Value>
                                                    <MultiBinding  Converter="{StaticResource ChildrenSelectorConverter}" >
                                                        <Binding Path="DataContext" RelativeSource="{RelativeSource Mode=Self}"/>
                                                        <!--<Binding Path="ChildrenSelector"  RelativeSource="{RelativeSource Mode=Self}"/>-->
                                                    </MultiBinding>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ResourceDictionary>
                                </TreeView.Resources>
                                <ct:CustomTreeView.ItemContainerStyleSelector>
                                    <bc:ItemContainerStyleSelector
                                    DefaultStyle="{StaticResource MyDefaultContentStyle}" 
                                    SelectableStyle="{StaticResource SelectedTreeViewItem}" 
                                    BreadcrumbStyle="{StaticResource BreachCrumb}" 
                                    BreadcrumbRootStyle ="{StaticResource BreadCrumbRootTreeViewItem}">
                                    </bc:ItemContainerStyleSelector>
                                </ct:CustomTreeView.ItemContainerStyleSelector>
                            </ct:CustomTreeView>
                        </Grid>
                    </Grid>
                </DockPanel>

            </DataTemplate>
        </ResourceDictionary>
    </Application.Resources>
</Application>
