<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:Utility.Nodes.Demo.Transformers"
             xmlns:filters="clr-namespace:Utility.Nodes.WPF;assembly=Utility.WPF.Trees" 
             xmlns:wpf="clr-namespace:Utility.Nodes.WPF;assembly=Utility.Nodes.WPF" 
             xmlns:node="clr-namespace:Utility.Nodes;assembly=Utility.Nodes"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             xmlns:inf="clr-namespace:Utility.Nodes.Filters;assembly=Utility.Nodes.Filters"
             xmlns:tree="clr-namespace:Utility.Trees;assembly=Utility.Trees"   
                    
             xmlns:conv="http://schemas.utility.com/converters"
             xmlns:bc="http://schemas.utility.com/Breadcrumbs"
             xmlns:ct="http://schemas.utility.com/trees"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors" 
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:beh="http://schemas.utility.com/behaviors"
             xmlns:att="http://schemas.utility.com/attached"
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit" 
             xmlns:abel="http://schemas.danielsabel.com/tinyhtmlwpf/2020" 
             xmlns:res="http://schemas.utility.com/resourcedictionary" 
             xmlns:utl="http://schemas.utility.com/utilitywpf" 
             xmlns:btns="http://schemas.utility.com/buttons"
             xmlns:obj="http://schemas.utility.com/objects">

    <ResourceDictionary.MergedDictionaries>
        <!--<res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Shared.xaml"/>-->
        <res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Templates.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <Style x:Key="MyDefaultContentStyle" TargetType="{x:Type ct:CustomTreeViewItem}">
        <Setter Property="NodeTemplate">
            <Setter.Value>
                <DataTemplate>
                    <ContentControl Content="{Binding Converter={StaticResource TypeNameConverter}}"></ContentControl>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ToolTip" Value="{Binding Key}"></Setter>
        <Setter Property="Background" Value="White"></Setter>
        <Setter Property="Orientation" Value="Horizontal"></Setter>
        <Setter Property="BorderThickness" Value="2"></Setter>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="NodeItemsSource">
            <Setter.Value>
                <MultiBinding  Converter="{StaticResource ChildrenSelectorConverter}" >
                    <Binding Path="DataContext" RelativeSource="{RelativeSource Mode=Self}"/>
                    <!--<Binding Path="ChildrenSelector"  RelativeSource="{RelativeSource Mode=Self}"/>-->
                </MultiBinding>
            </Setter.Value>
        </Setter>
    </Style>


    <filters:StyleSelector x:Key="StyleSelector" DefaultStyle="ViewContentStyle"></filters:StyleSelector>
    <!--<local:CollectionStyleSelector x:Key="CollectionStyleSelector"
                                           CollectionStyle="{StaticResource HeaderedItemsStyle}"
                                           ItemStyle="{StaticResource ContentStyle}"/>-->

    <wpf:SerialiserSource x:Key="SerialiserSource"/>

    <Style TargetType="{x:Type ct:CustomTreeViewItem}" x:Key="ExpandedTreeViewItem" >

        <Setter Property="BorderThickness" Value="2"></Setter>
        <Setter Property="Header" Value="{Binding Data}"></Setter>
        <Setter Property="ItemsPresenterVisibility" Value="Visible"></Setter>
    </Style>

    <DataTemplate DataType="{x:Type local:MainViewModel}">
        <DockPanel>

            <utl:SplitControl x:Name="splitcontrol"  Movement="{Binding ElementName=ToggleButton2, Path=Movement}">
                <utl:SplitControl.Content>

                    <Grid>
                        <Grid.RowDefinitions>

                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid  Grid.Row="0">


                            <ct:CustomTreeView ItemsSource="{Binding Content}" ItemContainerStyle="{StaticResource ExpandedTreeViewItem }" >
                                <!--<TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Items}">
                                        <Border BorderThickness="1" BorderBrush="GhostWhite" Margin="1">
                                            <ContentControl Content="{Binding Name}"/>
                                        </Border>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>-->

                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SelectedItemChanged">
                                        <beh:SetSelectedItemAction PropertyName="DataContext" TargetObject="{Binding ElementName=splitcontrol, Path=Header}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </ct:CustomTreeView>


                        </Grid>

                        <!--<btns:DirectionButton x:Name="ToggleButton2" Movement="LeftToRight" HorizontalAlignment="Right" Margin="0,0"></btns:DirectionButton>-->

                        <ct:CustomTreeView ItemsSource="{Binding Transformers}" Grid.Row="2" >
                            <ct:CustomTreeView.ItemContainerStyleSelector>
                                <bc:ItemContainerStyleSelector
                                                                            DefaultStyle="{StaticResource MyDefaultContentStyle}" 
                                                                            SelectableStyle="{StaticResource SelectedTreeViewItem}"
                                                                            BreadcrumbStyle="{StaticResource BreachCrumb}" 
                                                                            BreadcrumbRootStyle ="{StaticResource BreadCrumbRootTreeViewItem}">
                                </bc:ItemContainerStyleSelector>
                            </ct:CustomTreeView.ItemContainerStyleSelector>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="SelectedItemChanged">
                                    <beh:SetSelectedItemAction PropertyName="DataContext" TargetObject="{Binding ElementName=splitcontrol, Path=Header}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </ct:CustomTreeView>
                    </Grid>
                </utl:SplitControl.Content>
                <utl:SplitControl.Header>
                    <UniformGrid Columns="1">
                        <obj:JsonControl>
                            <i:Interaction.Behaviors>
                                <obj:ObjectBehavior  Object="{Binding }" JsonSerializer="{Binding Path=Serialiser, Source={StaticResource SerialiserSource}}"/>
                            </i:Interaction.Behaviors>
                        </obj:JsonControl>

                        <obj:JsonControl>
                            <i:Interaction.Behaviors>
                                <obj:ObjectBehavior  Object="{Binding Data}" />
                            </i:Interaction.Behaviors>
                        </obj:JsonControl>
                    </UniformGrid>
                </utl:SplitControl.Header>
            </utl:SplitControl>
        </DockPanel>
    </DataTemplate>

</ResourceDictionary>