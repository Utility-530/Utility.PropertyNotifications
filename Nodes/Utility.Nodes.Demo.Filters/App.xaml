<Application x:Class="Utility.Nodes.Demo.Filters.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:Utility.Nodes.Demo.Filters"
             xmlns:bc="http://schemas.utility.com/Breadcrumbs"
             xmlns:ct="http://schemas.utility.com/trees"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors" 
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             xmlns:inf="clr-namespace:Utility.Nodes.Filters;assembly=Utility.Nodes.Filters"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:beh="http://schemas.utility.com/behaviors"
             xmlns:att="http://schemas.utility.com/attached"
             xmlns:tree="clr-namespace:Utility.Trees;assembly=Utility.Trees"
             xmlns:filters="clr-namespace:Utility.Trees.Demo.Filters;assembly=Utility.Trees.Demo.Filters" 
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit" 
             xmlns:node="clr-namespace:Utility.Nodes;assembly=Utility.Nodes"
             xmlns:abel="http://schemas.danielsabel.com/tinyhtmlwpf/2020">

    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Themes/Styles.xaml"/>
                <ResourceDictionary Source="/Themes/Templates.xaml"/>
                <ResourceDictionary Source="/Utility.WPF.Controls.Trees;component/Themes/CustomTreeViewItem.xaml"/>
                <ResourceDictionary Source="/Utility.WPF.Controls.Breadcrumbs;component/Themes/Generic.xaml"/>
                <!--<ResourceDictionary Source="/Utility.WPF.Controls.ComboBoxes;component/Themes/CustomComboTreeViewItemStyle.xaml"/>
                <ResourceDictionary Source="/Utility.WPF.Controls.ComboBoxes;component/Themes/ButtonComboBoxTreeViewStyle.xaml"/>-->
            </ResourceDictionary.MergedDictionaries>


            <filters:StyleSelector x:Key="StyleSelector" DefaultStyle="ViewContentStyle"></filters:StyleSelector>



            <DataTemplate DataType="{x:Type local:MainViewModel}">
                <DockPanel>
                    <ct:ComboTreeView  DockPanel.Dock="Top" ItemsSource="{Binding Selection}">
                        <ItemsControl.ItemContainerStyleSelector>
                            <local:ComboContainerStyleSelector
                                    DefaultStyle="{StaticResource DefaultStyle}" 
                                    ComboStyle="{StaticResource ComboExStyle}">
                            </local:ComboContainerStyleSelector>
                        </ItemsControl.ItemContainerStyleSelector>
                    </ct:ComboTreeView>

                    <Grid DockPanel.Dock="Left">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="3*"></RowDefinition>
                            <RowDefinition Height="*"></RowDefinition>
                        </Grid.RowDefinitions>
                        <ct:CustomTreeView ItemsSource="{Binding Clones}" ItemContainerStyle="{StaticResource DefaultContentStyle}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="SelectedItemChanged">
                                    <beh:SetSelectedItemAction PropertyName="Content" TargetObject="{Binding ElementName=TreeContent}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </ct:CustomTreeView>
                        <ListView Grid.Row="1" ItemsSource="{Binding Dirty}">
                            <ListView.View>
                                <GridView AllowsColumnReorder="true" ColumnHeaderToolTip="Employee Information">

                                    <GridViewColumn DisplayMemberBinding="{Binding Path=Key}" Header="Key" Width="100"/>
                                    <GridViewColumn DisplayMemberBinding="{Binding Path=Value.PropertyName}" Header="Name" Width="100"/>
                                    <GridViewColumn DisplayMemberBinding="{Binding Path=Value.NewValue}" Header="New Value" Width="100"/>
                                    <GridViewColumn DisplayMemberBinding="{Binding Path=Value.PreviousValue}" Width="100">
                                        <GridViewColumnHeader>Old Value
                                            <!--<GridViewColumnHeader.ContextMenu>
                                                <ContextMenu Name="LastNameCM">
                                                    <MenuItem Header="Ascending" />
                                                    <MenuItem Header="Descending" />
                                                </ContextMenu>
                                            </GridViewColumnHeader.ContextMenu>-->
                                        </GridViewColumnHeader>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"></ColumnDefinition>
                            <ColumnDefinition Width="5"></ColumnDefinition>
                            <ColumnDefinition Width="Auto"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="0.07*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="0.2*"/>
                            </Grid.RowDefinitions>

                            <Viewbox Grid.Row="0" HorizontalAlignment="Left">
                                <ct:CustomTreeView  ItemsSource="{Binding Controls}" ItemContainerStyle="{StaticResource DefaultStyle}"/>
                            </Viewbox>

                            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch"              ShowsPreview="True" />

                            <Grid  Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"></ColumnDefinition>
                                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                                    <ColumnDefinition Width="1*"></ColumnDefinition>
                                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                                    <ColumnDefinition Width="1*"></ColumnDefinition>
                                    <!--<ColumnDefinition Width="0.5*"></ColumnDefinition>-->
                                </Grid.ColumnDefinitions>

                                <ct:CustomTreeView Grid.Column="0" ItemsSource="{Binding Content}" ItemContainerStyleSelector="{StaticResource StyleSelector }" >
                                    <TreeView.ItemTemplate>
                                        <HierarchicalDataTemplate ItemsSource="{Binding Items}">
                                            <Border BorderThickness="1" BorderBrush="GhostWhite" Margin="1">
                                                <ContentControl Content="{Binding Path=.}" ContentTemplateSelector="{x:Static filters:DataTemplateSelector.Instance}"/>
                                            </Border>
                                        </HierarchicalDataTemplate>
                                    </TreeView.ItemTemplate>

                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="SelectedItemChanged">
                                            <beh:SetSelectedItemAction PropertyName="Content" TargetObject="{Binding ElementName=TreeContent}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </ct:CustomTreeView>

                                <GridSplitter Grid.Column="1" Width="5" VerticalAlignment="Stretch"               ShowsPreview="True"/>

                                <TreeView Grid.Column="2" ItemsSource="{Binding Html}">
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="{x:Type TreeViewItem}">
                                            <Setter Property="Header" Value="{Binding Data}"/>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <avalonedit:TextEditor 
                                            x:Name="textHtml" 
                                            local:TextEdit.Text="{Binding Value, Mode=TwoWay}" 
                                            SyntaxHighlighting="HTML" 
                                            ShowLineNumbers="True" />
                                            <!--<TextBox Text="{Binding Value, Mode=TwoWay}" ></TextBox>-->
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </TreeView>

                                <GridSplitter Grid.Column="3" Width="5" VerticalAlignment="Stretch"               ShowsPreview="True"/>


                                <TreeView Grid.Column="4" ItemsSource="{Binding Html_Render}">
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="{x:Type TreeViewItem}">
                                            <Setter Property="Header" Value="{Binding Data}"/>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <abel:WpfHtmlControlBase Html="{Binding Value, Mode=OneWay}"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </TreeView>


                            </Grid>


                            <GridSplitter Grid.Row="3"   HorizontalAlignment="Stretch"
                                          VerticalAlignment="Center"
                                          ShowsPreview="True"
                                          Height="5" />

                            <ct:CustomTreeView Grid.Row="4" ItemsSource="{Binding Filters}" >
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SelectedItemChanged">
                                        <beh:SetSelectedItemAction PropertyName="Content" TargetObject="{Binding ElementName=TreeContent}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <ct:CustomTreeView.ItemContainerStyleSelector>
                                    <bc:ItemContainerStyleSelector
                                    DefaultStyle="{StaticResource DefaultStyle}" 
                                    SelectableStyle="{StaticResource SelectedTreeViewItem}" 
                                    BreadcrumbStyle="{StaticResource BreachCrumb}" 
                                    BreadcrumbRootStyle ="{StaticResource BreadCrumbRootTreeViewItem}">
                                    </bc:ItemContainerStyleSelector>
                                </ct:CustomTreeView.ItemContainerStyleSelector>
                            </ct:CustomTreeView>
                        </Grid>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" />

                        <ContentControl x:Name="TreeContent" Grid.Column="2" >
                            <ContentControl.Template>
                                <ControlTemplate TargetType="{x:Type ContentControl}">
                                    <DockPanel>
                                        <ToggleButton x:Name="hider" DockPanel.Dock="Top">hide</ToggleButton>
                                        <Border x:Name="presenter" Width="400">
                                            <ContentPresenter />
                                        </Border>
                                    </DockPanel>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="True">
                                            <Setter TargetName="presenter" Property="Visibility" Value="Collapsed" />
                                            <Setter TargetName="hider" Property="Content" Value="show" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsChecked, ElementName=hider}" Value="False">
                                            <Setter TargetName="presenter" Property="Visibility" Value="Visible" />
                                            <Setter TargetName="hider" Property="Content" Value="hide" />
                                        </DataTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ContentControl.Template>
                            <ContentControl.Style>
                                <Style TargetType="{x:Type ContentControl}" BasedOn="{StaticResource {x:Type ContentControl}}">
                                    <Style.Triggers>
                                        <Trigger Property="Content" 
                                                 Value="{x:Null}">
                                            <Setter 
                                                Property="Visibility"
                                                Value="Collapsed" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ContentControl.Style>
                            <ContentControl.Resources>
                                <ResourceDictionary>
                                    <ResourceDictionary.MergedDictionaries>
                                        <ResourceDictionary Source="pack://application:,,,/HandyControl;component/Themes/SkinDefault.xaml" />
                                        <ResourceDictionary Source="pack://application:,,,/HandyControl;component/Themes/Theme.xaml" />
                                    </ResourceDictionary.MergedDictionaries>
                                </ResourceDictionary>
                            </ContentControl.Resources>
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="{x:Type node:Node}">
                                    <UniformGrid Columns="1">
                                        <hc:PropertyGrid SelectedObject="{Binding }"/>
                                        <hc:PropertyGrid SelectedObject="{Binding Data}"/>
                                    </UniformGrid>
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </Grid>
                </DockPanel>

            </DataTemplate>
        </ResourceDictionary>
    </Application.Resources>
</Application>
