<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:att="http://schemas.utility.com/attached"
    xmlns:beh="http://schemas.utility.com/behaviors"
    xmlns:controls="http://schemas.utility.com/cboxes"
    xmlns:conv="http://schemas.utility.com/converters"
    xmlns:ct="http://schemas.utility.com/trees"
    xmlns:customtrees="CustomTrees"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:icons="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:local="clr-namespace:Utility.Nodes.WPF"
    xmlns:res="http://schemas.utility.com/resourcedictionary"
    xmlns:trees="http://schemas.utility.com/trees">

    <ResourceDictionary.MergedDictionaries>
        <res:SharedResourceDictionary Source="/Utility.Nodes.WPF;component/Themes/Shared.xaml" />
        <res:SharedResourceDictionary Source="/Utility.WPF.Controls.ComboBoxes;component/Themes/CustomComboTreeViewItemStyle.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <Style
        x:Key="DefaultContentStyle"
        BasedOn="{StaticResource CustomComboTreeViewItemStyle}"
        TargetType="{x:Type trees:CustomTreeViewItem}">
        <Style.Resources>
            <Style
                x:Key="Type_Style"
                BasedOn="{StaticResource ButtonComboBoxTreeViewStyle}"
                TargetType="{x:Type controls:ComboBoxTreeView}">
                <Setter Property="ToggleButtonContent" Value="{StaticResource Icon}" />
                <Setter Property="ParentPath" Value="Parent" />
                <att:InteractivitySetter Property="att:InteractivityItems.Template">
                    <Setter.Value>
                        <att:InteractivityTemplate>
                            <att:InteractivityItems>
                                <att:InteractivityItems.Triggers>
                                    <i:EventTrigger EventName="SelectedNodeChanged">
                                        <beh:InvokeCommandAction
                                            Command="{Binding AddCommand}"
                                            EventArgsConverter="{StaticResource SelectedNodeChangeConverter}"
                                            EventArgsConverterParameter="{Binding Path=DataContext, RelativeSource={RelativeSource AncestorType=TreeViewItem}}" />
                                    </i:EventTrigger>
                                </att:InteractivityItems.Triggers>
                            </att:InteractivityItems>
                        </att:InteractivityTemplate>
                    </Setter.Value>
                </att:InteractivitySetter>
            </Style>
        </Style.Resources>
        <Setter Property="ItemsPresenterVisibility" Value="Visible" />
        <!--  IsExpanded needs to be false otherwise ItemsPresenterVisibility won't have an effect  -->
        <!--<Setter Property="IsExpanded" Value="False"></Setter>-->
        <Setter Property="IsEditable" Value="True" />
        <Setter Property="ChildrenSelector" Value="{StaticResource ChildrenSelector}" />
        <Setter Property="SplitButtonStyle" Value="{StaticResource Type_Style}" />
        <Setter Property="ToolTip" Value="{Binding Key}" />
        <Setter Property="Background" Value="White" />
        <Setter Property="Orientation" Value="Horizontal" />
        <Setter Property="BorderThickness" Value="2" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="NodeItemsSource">
            <Setter.Value>
                <MultiBinding Converter="{StaticResource ChildrenSelectorConverter}">
                    <Binding Path="DataContext" RelativeSource="{RelativeSource Mode=Self}" />
                    <Binding Path="ChildrenSelector" RelativeSource="{RelativeSource Mode=Self}" />
                </MultiBinding>
            </Setter.Value>
        </Setter>
        <Setter Property="EditTemplateSelector">
            <Setter.Value>
                <local:EditTemplateSelector>
                    <local:EditTemplateSelector.AndOrModelTemplate>
                        <DataTemplate>
                            <Ellipse
                                Width="20"
                                Height="20"
                                Fill="Red" />
                        </DataTemplate>
                    </local:EditTemplateSelector.AndOrModelTemplate>
                    <local:EditTemplateSelector.ResolvableModelTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding Name}" />
                        </DataTemplate>
                    </local:EditTemplateSelector.ResolvableModelTemplate>
                </local:EditTemplateSelector>
            </Setter.Value>
        </Setter>
        <Setter Property="NodeTemplate">
            <Setter.Value>
                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                    <Border
                        Margin="1"
                        BorderBrush="GhostWhite"
                        BorderThickness="1">
                        <ContentControl Content="{Binding Name}" />
                    </Border>
                </HierarchicalDataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplate">
            <Setter.Value>
                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                    <Border
                        Margin="1"
                        BorderBrush="GhostWhite"
                        BorderThickness="1">
                        <ContentControl Content="{Binding Name}" Foreground="{Binding TemplatedParent.Foreground, RelativeSource={RelativeSource Mode=TemplatedParent}}" />
                    </Border>
                </HierarchicalDataTemplate>
            </Setter.Value>
        </Setter>

        <Style.Triggers>
            <DataTrigger Binding="{Binding Removed, Converter={StaticResource InverseNullToBooleanConverter}}" Value="True">
                <Setter Property="Background" Value="LightGray" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="IsEnabled" Value="False" />
                <Setter Property="IsEditable" Value="False" />
                <Setter Property="ItemsPresenterVisibility" Value="Collapsed" />
            </DataTrigger>
        </Style.Triggers>
    </Style>
</ResourceDictionary>