<Application x:Class="Utility.Nodify.Transitions.Demo.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:Utility.Nodify.Transitions.Demo"
             xmlns:nodify="https://miroiu.github.io/nodify"    
             xmlns:vm="clr-namespace:Utility.Nodify.Models;assembly=Utility.Nodify.Models"
             xmlns:vm1="clr-namespace:Utility.Nodify.ViewModels;assembly=Utility.Nodify.ViewModels" 
             xmlns:templates="http://schemas.utility.com/templates" 
             xmlns:models="clr-namespace:Utility.Models.Diagrams;assembly=Utility.Models.Diagrams">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Nodify;component/Themes/Nodify.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nodify;component/Themes/Light.xaml" />
                <!--<ResourceDictionary Source="pack://application:,,,/Nodify.Shared;component/Themes/Icons.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Nodify.Shared;component/Themes/Light.xaml" />-->

                
                <ResourceDictionary Source="/Utility.Nodify.Views;component/Templates.xaml"></ResourceDictionary>
                <ResourceDictionary Source="/Utility.Nodify.Views;component/Brushes.xaml"></ResourceDictionary>
                <ResourceDictionary Source="/Utility.Nodify.Views;component/DiagramView.xaml"></ResourceDictionary>
                <ResourceDictionary Source="/Utility.Nodify.Views;component/MainView.xaml"></ResourceDictionary>               
                
                <ResourceDictionary Source="/Utility.WPF.Controls.Simulation;component/Themes/Generic.xaml"></ResourceDictionary>

            </ResourceDictionary.MergedDictionaries>

            
            <Style x:Key="IconButton"
                   TargetType="{x:Type Button}"
                   BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Padding"
                Value="1 2" />
                <Setter Property="HorizontalAlignment"
                Value="Left" />
                <Setter Property="VerticalAlignment"
                Value="Center" />
                <Setter Property="Background"
                Value="Transparent" />
                <Setter Property="BorderBrush"
                Value="{DynamicResource HighlightedBackgroundBrush}" />
                <Setter Property="Foreground"
                Value="{DynamicResource ForegroundBrush}" />
                <Setter Property="FocusVisualStyle"
                Value="{StaticResource {x:Static SystemParameters.FocusVisualStyleKey}}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border x:Name="PART_Border"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}"
                            SnapsToDevicePixels="True">
                                <ContentPresenter x:Name="contentPresenter"
                                          Focusable="False"
                                          Margin="{TemplateBinding Padding}"
                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver"
                                 Value="True">
                                    <Setter TargetName="PART_Border"
                                    Property="Background"
                                    Value="{Binding BorderBrush, RelativeSource={RelativeSource TemplatedParent}}" />
                                </Trigger>
                                <Trigger Property="IsPressed"
                                 Value="True">
                                    <Setter TargetName="PART_Border"
                                    Property="Background"
                                    Value="{Binding BorderBrush, RelativeSource={RelativeSource TemplatedParent}}" />
                                </Trigger>
                                <Trigger Property="IsEnabled"
                                 Value="False">
                                    <Setter Property="Foreground"
                                    Value="{DynamicResource DisabledForegroundBrush}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate DataType="{x:Type vm:ConnectorViewModel}">
                <Button Style="{StaticResource IconButton}"
                                                     Command="{x:Static nodify:EditorCommands.BringIntoView}"
                                                                    CommandParameter="{Binding Location}"
                                                                    CommandTarget="{Binding ElementName=Editor}"
                                                                    Foreground="DodgerBlue">
                    <TextBlock Text="{Binding Title}"
                                       TextDecorations="Underline" >
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="Foreground"
                                                                    Value="{DynamicResource ForegroundBrush}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsActive}"
                                                                             Value="True">
                                        <Setter Property="Foreground"
                                                                            Value="{DynamicResource ActiveStateBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Button>
            </DataTemplate>

            <DataTemplate DataType="{x:Type vm:ConnectionViewModel}">

                <ItemsControl>
                    <ContentControl Content="{Binding Input}"></ContentControl>
                    <Rectangle  Height="4" HorizontalAlignment="Stretch" MinWidth="4">
                        <Rectangle.Style>

                            <Style TargetType="{x:Type Rectangle}">
                                <Setter Property="Fill"
                                                                    Value="{DynamicResource ForegroundBrush}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsActive}"
                                                                             Value="True">
                                        <Setter Property="Fill"
                                                                            Value="{DynamicResource ActiveStateBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Rectangle.Style>
                    </Rectangle>
                    <ContentControl Content="{Binding Output}"></ContentControl>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="1"></UniformGrid>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </DataTemplate>

            <local:TemplateSelector x:Key="TemplateSelector"/>

            <DataTemplate DataType="{x:Type local:MainViewModel}">
                <ItemsControl ItemsSource="{Binding Collection}" ItemTemplateSelector="{StaticResource TemplateSelector}" >
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="{x:Type ContentPresenter}">
                            <Setter Property="Grid.Row" Value="{Binding GridRow}"></Setter>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                            </Grid>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

            </DataTemplate>


            <DataTemplate DataType="{x:Type models:MethodNode}">
                <TextBlock Text="{Binding Method.Name}" ToolTip="{Binding Method.MethodInfo.ReflectedType.FullName}"></TextBlock>
            </DataTemplate>

            <DataTemplate DataType="{x:Type models:MethodAction}">
                <TextBlock Text="{Binding MethodNode.Method.Name}" ToolTip="{Binding MethodNode.Method.MethodInfo.ReflectedType.FullName}"></TextBlock>
            </DataTemplate>

            <DataTemplate DataType="{x:Type models:MethodConnector}">
                <Grid>
                    <!--<Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>-->
                    <!--<TextBlock Text="{Binding Key}"/>-->

                    <ContentControl Content="{Binding Value}" ContentTemplateSelector="{x:Static templates:CustomDataTemplateSelector.Instance}"></ContentControl>
                </Grid>

            </DataTemplate>

        </ResourceDictionary>
    </Application.Resources>
</Application>
