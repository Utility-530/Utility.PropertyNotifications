<Window x:Class="Utility.Nodify.Sandbox.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Utility.Nodify.Sandbox"
        xmlns:views="clr-namespace:Utility.Nodify.Views.Infrastructure;assembly=Utility.Nodify.Views"
        xmlns:nodify="https://miroiu.github.io/nodify"
        xmlns:lsts="http://schemas.utility.com/lists"
        xmlns:models="clr-namespace:Utility.Nodify.Models;assembly=Utility.Nodify.Models" 
        xmlns:ad="http://schemas.utility.com/adorners"
        mc:Ignorable="d"
        Title="MainWindow" Height="450" Width="800">

    <Window.Resources>
        <DataTemplate DataType="{x:Type models:NodeViewModel}">
            <!--<DataTemplate.Resources>
                 
                                <CollectionViewSource x:Key="TheWeeksBlocksSource" Source="{Binding Output}" />

                            <CompositeCollection x:Key="CompositeCollectionSource">
                                <CollectionContainer Collection="{Binding Source={StaticResource TheWeeksBlocksSource}}" />
                                <ListBoxItem Foreground="Red">Other</ListBoxItem>
                            </CompositeCollection>
                        </DataTemplate.Resources>-->
            <nodify:Node Content="{Binding Data}"
                                 ContentTemplateSelector="{StaticResource NodeTemplateSelector}">
                <nodify:Node.Style>
                    <Style TargetType="{x:Type nodify:Node}"
                                    BasedOn="{StaticResource {x:Type nodify:Node}}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsConnectorsReversed}" Value="True">
                                <Setter Property="Footer" Value="{Binding Input}"></Setter>
                                <Setter Property="Header" Value="{Binding Output}"></Setter>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding Data.IsActive}"
                                                    Value="True">
                                <Setter Property="ContentBrush"
                                                Value="{DynamicResource ActiveStateBrush}" />
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <ColorAnimation Storyboard.TargetProperty="BorderBrush.Color"
                                                From="Transparent" To="Cyan" 
                                                Duration="0:0:1" AutoReverse="True"/>
                                            <!--<ThicknessAnimation Storyboard.TargetProperty="BorderThickness"
                                                    From="2" To="4" Duration="0:0:1" AutoReverse="True"/>-->
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetProperty="BorderBrush.Color"
                                                To="Transparent" Duration="0:0:0.3"/>
                                            <!--<ThicknessAnimation Storyboard.TargetProperty="BorderThickness"
                                                    To="2" Duration="0:0:0.3"/>-->
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                            <!--<DataTrigger Binding="{Binding Data.Exception, Converter={x:Static conv:InverseNullToBooleanConverter.Instance}}"
                                                    Value="True">
                                <Setter Property="BorderBrush"
                                                Value="Red" />
                                <Setter Property="ContentBrush"
                                                Value="Red" />
                            </DataTrigger>-->
                        </Style.Triggers>
                        <Setter Property="Footer" Value="{Binding Output}" />

                        <Setter Property="Header" Value="{Binding Input}">

                        </Setter>
                        <Setter Property="VerticalAlignment" Value="Stretch"></Setter>
                        <Setter Property="HorizontalAlignment" Value="Stretch"></Setter>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"></Setter>
                        <Setter Property="VerticalContentAlignment" Value="Stretch"></Setter>

                        <Setter Property="BorderBrush">
                            <Setter.Value>
                                <SolidColorBrush Color="Transparent"/>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="BorderThickness" Value="4"/>

                    </Style>
                </nodify:Node.Style>
                <!--<nodify:Node.ContentTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                           Margin="5" />
                                </DataTemplate>
                            </nodify:Node.ContentTemplate>-->
                <nodify:Node.HeaderTemplate>
                    <DataTemplate>
                        <ItemsControl ItemsSource="{Binding}"
                                              Focusable="False">
                            <!--<ad:AdornerEx.LastItemAdorner>
                                <x:Static Member="local:Command.Instance" />
                            </ad:AdornerEx.LastItemAdorner>-->
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:ConnectorViewModel}">
                                    <nodify:NodeInput Orientation="Horizontal" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"
                                                        HorizontalAlignment="Center" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </DataTemplate>
                </nodify:Node.HeaderTemplate>
                <nodify:Node.FooterTemplate>
                    <DataTemplate>
                        <ItemsControl ItemsSource="{Binding}"
                                                  Width="100"
                                              Focusable="False">
                            <!--<ad:AdornerEx.LastItemAdorner>
                                <x:Static Member="local:Command.Instance" />
                            </ad:AdornerEx.LastItemAdorner>-->
                            <!--<ItemsControl.EditTemplate>
                                <DataTemplate>
                                    
                                </DataTemplate>
                            </ItemsControl.EditTemplate>-->
                            <ItemsControl.ItemTemplateSelector>
                                <local:ConnectorTemplateSelector>
                                    <local:ConnectorTemplateSelector.DefaultTemplate>
                                        <DataTemplate DataType="{x:Type models:ConnectorViewModel}">
                                            <nodify:NodeOutput Orientation="Horizontal" />
                                        </DataTemplate>
                                    </local:ConnectorTemplateSelector.DefaultTemplate>
                                    <local:ConnectorTemplateSelector.PendingTemplate>
                                        <DataTemplate DataType="{x:Type models:PendingConnectorViewModel}">
                                            <nodify:NodeOutput Orientation="Horizontal" Style="{StaticResource Pending}"/>
                                        </DataTemplate>
                                    </local:ConnectorTemplateSelector.PendingTemplate>
                                </local:ConnectorTemplateSelector>
                            </ItemsControl.ItemTemplateSelector>
                 
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"
                                                        HorizontalAlignment="Center" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </DataTemplate>
                </nodify:Node.FooterTemplate>
            </nodify:Node>
        </DataTemplate>

    </Window.Resources>
    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>

    <TabControl>
        <TabItem Header="Diagram">
            <Grid Width="300" Height="100">
                <ContentControl Content="{Binding Node}" />

            </Grid>
        </TabItem>
        <TabItem Header="Node">

        </TabItem>
    </TabControl>
</Window>
